<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>KBExplorer (AGISystem2)</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <header class="topbar">
      <div class="topbar__title">KBExplorer</div>
      <div class="topbar__meta">
        <span id="sessionLabel" class="mono">session: (initializing)</span>
        <span id="kbFactsStat" class="mono muted">Facts: 0</span>
        <label class="label label--topbar">HDC
          <select id="strategySelect" class="mono">
            <option value="exact">exact</option>
            <option value="dense-binary">dense-binary</option>
            <option value="sparse-polynomial">sparse-polynomial</option>
            <option value="metric-affine">metric-affine</option>
            <option value="metric-affine-elastic">metric-affine-elastic</option>
          </select>
        </label>
        <label class="label label--topbar">Reasoning
          <select id="reasoningSelect" class="mono">
            <option value="symbolicPriority">symbolicPriority</option>
            <option value="holographicPriority">holographicPriority</option>
          </select>
        </label>
        <label class="label label--topbar" title="When enabled, URC audit surfaces also include derived fact DSL lines for debugging (not injected into the KB truth store). This can be slower.">
          <input id="urcMaterializeFactsToggle" type="checkbox" />
          <span>URC audit</span>
        </label>
        <button id="packsBtn" type="button" class="btn btn--ghost" title="Select which config packs to load into each new Session universe">Packs…</button>
        <button id="newSessionBtn" type="button" class="btn btn--ghost" title="Create a new isolated Session universe">New session</button>
        <button id="resetSessionBtn" type="button" class="btn btn--ghost" title="Reset current Session universe">Reset</button>
      </div>
    </header>

    <dialog id="packsDialog" class="dialog" aria-label="Select packs">
      <div class="dialog__header">
        <div>
          <div class="dialog__title">Packs</div>
          <div class="dialog__subtitle muted">Select which config packs are loaded into new sessions.</div>
        </div>
      </div>

      <div class="dialog__body">
        <div class="dialog__row">
          <input id="packsSearch" type="search" class="dialog__search" placeholder="Filter packs..." />
          <span id="packsCount" class="muted"></span>
        </div>

        <div class="dialog__row dialog__row--buttons">
          <button id="packsDefaultsBtn" type="button" class="btn btn--ghost">Defaults</button>
          <button id="packsAllBtn" type="button" class="btn btn--ghost">All</button>
          <button id="packsNoneBtn" type="button" class="btn btn--ghost">None</button>
        </div>

        <div id="packsList" class="packList" aria-label="Available packs"></div>
      </div>

      <div class="dialog__footer">
        <button id="packsCancelBtn" type="button" class="btn btn--ghost">Cancel</button>
        <button id="packsApplyBtn" type="button" class="btn btn--primary">Apply</button>
      </div>
    </dialog>

    <main class="layout">
      <section class="tabs">
        <div class="tabs__bar" role="tablist" aria-label="KBExplorer tabs">
          <button id="tabChat" type="button" class="tab tab--active" role="tab" aria-selected="true">Chat</button>
          <button id="tabKB" type="button" class="tab" role="tab" aria-selected="false">KB Explorer</button>
          <button id="tabDsl" type="button" class="tab" role="tab" aria-selected="false">DSL Examples</button>
          <button id="tabNl" type="button" class="tab" role="tab" aria-selected="false">NL Examples</button>
        </div>

        <div id="panelChat" class="tabs__panel tabs__panel--active" role="tabpanel">
          <div id="chat" class="chat" aria-label="Conversation history"></div>

          <div class="composer">
            <div class="composer__row">
              <label class="label">Mode
                <select id="modeSelect">
                  <option value="query">query</option>
                  <option value="prove">prove</option>
                  <option value="learn">learn</option>
                  <option value="abduce">abduce</option>
                  <option value="findAll">findAll</option>
                </select>
              </label>
              <label class="label">Input
                <select id="inputModeSelect">
                  <option value="nl">NL</option>
                  <option value="dsl">DSL</option>
                </select>
              </label>

              <input id="theoryFile" type="file" accept=".sys2,.txt" multiple hidden />
              <button id="loadBtn" type="button" class="btn">Load...</button>
              <button id="cancelLoadBtn" type="button" class="btn btn--ghost" disabled>Cancel</button>
            </div>

            <textarea id="textInput" class="composer__input" rows="3" placeholder="Type Natural Language (NL) or Sys2DSL..."></textarea>
            <div class="composer__row composer__row--end">
              <button id="sendBtn" type="button" class="btn btn--primary">Send</button>
            </div>
          </div>
        </div>

        <div id="panelKB" class="tabs__panel" role="tabpanel">
          <div class="kb">
            <div class="kb__toolbar">
              <input id="factFilter" class="kb__search" type="search" placeholder="Search session..." />
              <div class="kb__meta">
                <label class="label">
                  <input id="complexOnlyToggle" type="checkbox" />
                  <span title="When enabled, shows only entries whose vector has at least 2 polynomial terms (EXACT: >=2 monomials; SPHDC: >=2 exponents). For Lexicon entries, this prefers the named definition-fact vector when available.">Complex</span>
                </label>
                <span id="factCount" class="muted"></span>
                <button id="refreshFactsBtn" type="button" class="btn btn--ghost">Refresh</button>
              </div>
            </div>

            <div class="kb__legend" aria-label="KB explorer legend">
              <span class="legend__item"><span class="ico ico--fact">⊕</span>Fact (bundle)</span>
              <span class="legend__item"><span class="ico ico--bind">⊗</span>Bind (position-tag)</span>
              <span class="legend__item"><span class="ico ico--verb">V</span>Verb / operator</span>
              <span class="legend__item"><span class="ico ico--atom">•</span>Atom</span>
              <span class="legend__item muted">Tip: click any node to see details; expand nodes to browse definitions.</span>
            </div>

            <div class="explorer" aria-label="KB filesystem explorer">
              <div class="explorer__tree">
                <div id="kbTree" class="tree" aria-label="KB tree"></div>
              </div>
              <div class="explorer__details">
                <div class="details__header">
                  <div class="details__title">Details</div>
                </div>
                <div id="kbDetails" class="details" aria-label="Selected node details"></div>
              </div>
            </div>
          </div>
        </div>

        <div id="panelDsl" class="tabs__panel" role="tabpanel">
          <div class="docs">
            <h2>DSL Examples</h2>
            <p class="muted">Use these with Input = <span class="mono">DSL</span>.</p>

            <h3>learn (facts + naming)</h3>
            <pre class="code"># Anonymous facts (persist to KB)
isA Anne Dog
isA Dog Animal
hasProperty Anne Friendly
in Anne Kitchen

# Named KB facts (persist under a name)
@:anneIsDog isA Anne Dog
@cond isA ?x Dog
@cons isA ?x Animal
@:allDogsAreAnimals Implies $cond $cons</pre>

            <h3>query (holes)</h3>
            <pre class="code">@q1 isA Anne ?x
@q2 hasProperty ?who Friendly
@q3 parent Harry ?child</pre>

            <h3>prove (true/false + proof)</h3>
            <pre class="code">isA Anne Dog
isA Dog Animal
@goal isA Anne Animal
Not (isA Anne Cat)</pre>

            <h3>solve (planning) inside learn</h3>
            <pre class="code"># Action model
at Alice Home
requires MoveToPark at Alice Home
causes MoveToPark at Alice Park
prevents MoveToPark at Alice Home

@goal at Alice Park
@plan solve planning [
  (goal goal),
  (maxDepth 3)
]</pre>

            <h3>solve (CSP) inside learn</h3>
            <pre class="code">isA Alice Guest
isA Bob Guest
isA T1 Table
isA T2 Table
conflictsWith Alice Bob
conflictsWith Bob Alice

@seating solve csp [
  (variablesFrom Guest),
  (domainFrom Table),
  (noConflict conflictsWith)
]</pre>

            <h3>meta-queries (DS17)</h3>
            <pre class="code"># Setup
isA Hammer Tool
has Hammer Handle
has Hammer Head
isA Mallet Tool
has Mallet Handle
has Mallet Head

# Query similar entities
@q similar Hammer ?entity</pre>

            <h3>Hello world: Complex vectors (bundle)</h3>
            <p class="muted">
              This creates a named fact whose vector is a true bundle (EXACT: at least 2 monomials).
              After running it, enable <span class="mono">Complex</span> and find <span class="mono">BundleHello</span> in Facts and Lexicon.
            </p>
            <pre class="code"># Ensure a symbol exists in the Lexicon (no KB fact created here)
@tmp BundleHello

# Named KB fact with a bundled vector (2 terms)
@:BundleHello ___Bundle A B</pre>
          </div>
        </div>

        <div id="panelNl" class="tabs__panel" role="tabpanel">
          <div class="docs">
            <h2>NL Examples</h2>
            <p class="muted">Use these with Input = <span class="mono">NL</span>. NL is grammar-based and can be ambiguous.</p>

            <h3>learn</h3>
            <pre class="code">Anne is a dog.
All dogs are animals.
Mary is in the kitchen.
Harry is the parent of Jack.
Anne does not like Bob.</pre>

            <h3>query / prove</h3>
            <pre class="code">Is Anne an animal?
Does Anne not like Bob?
What is Anne?
What color is the cat?
Is there an animal?
No cats are dogs.</pre>

            <h3>rules</h3>
            <pre class="code">If someone is a dog, then they are an animal.
If Harry is the parent of Jack, then Jack is a child.</pre>

            <h3>solve (KBExplorer directives in NL mode)</h3>
            <p class="muted">These are KBExplorer shortcuts (not generic NL→DSL grammar).</p>
            <pre class="code">Solve planning: goal: at Alice Park. maxDepth: 3. as: plan
Solve csp: variables from Guest, domain from Table, noConflict conflictsWith, as seating</pre>

            <h3>Why “A is B” can look strange</h3>
            <p>
              In English, <span class="mono">a</span> is usually an article, not an entity name.
              Prefer proper names (e.g. <span class="mono">Alice is a doctor</span>) or use DSL when you mean literal symbols.
            </p>
            <pre class="code"># If you mean literal symbols:
isA A B</pre>
          </div>
        </div>
      </section>
    </main>

    <script type="module" src="/app.js"></script>
  </body>
</html>
