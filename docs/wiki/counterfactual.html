<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Counterfactuals</title>
  <link rel="stylesheet" href="../reference/style.css">
</head>
<body>
  <div class="page">
  <div class="nav-header">
    <h1>AGISystem2 – Counterfactuals</h1>
    <small>
      <a href="../index.html">Home</a> ·
      <a href="../guides/conceptual_spaces.html">Theory</a> ·
      <a href="../architecture/index.html">Architecture</a> ·
      <a href="../api/index.html">APIs</a> ·
      <a href="../syntax/index.html">Syntax</a> ·
      <a href="../usage-cli/index.html">CLI</a> ·
      <a href="index.html">Wiki</a> ·
      <a href="../specs/matrix.html">Specs</a>
    </small>
  </div>

  <p>Counterfactual reasoning in AGISystem2 uses <a href="theory_layers.html">theory layers</a> to explore "what if" scenarios. A temporary layer holds hypothetical facts that override base knowledge. After reasoning in this altered world, the layer is discarded and reality is restored.</p>

  <div class="diagram">
    <svg viewBox="0 0 560 300" role="img" aria-label="Counterfactual reasoning with layers">
      <defs>
        <marker id="arrow-cf" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto" markerUnits="strokeWidth">
          <path d="M0,0 L6,3 L0,6 z" fill="#0f4c81" />
        </marker>
      </defs>

      <!-- Background -->
      <rect x="0" y="0" width="560" height="300" fill="#fafbfc"/>

      <!-- Step 1: Base state -->
      <rect x="20" y="20" width="120" height="120" rx="4" fill="#f5f7fb" stroke="#b0b6c4" stroke-width="1"/>
      <text x="80" y="40" font-size="9" font-weight="bold" fill="#4a5670" text-anchor="middle">1. Base State</text>

      <rect x="35" y="55" width="90" height="35" rx="4" fill="#e1ecf7" stroke="#0f4c81" stroke-width="2"/>
      <text x="80" y="70" font-size="8" font-weight="bold" fill="#0f4c81" text-anchor="middle">Base Knowledge</text>
      <text x="80" y="82" font-size="7" fill="#4a5670" text-anchor="middle">Water IS_A Liquid</text>

      <text x="80" y="115" font-size="8" fill="#4a5670" text-anchor="middle">ASK "Water IS_A ?"</text>
      <text x="80" y="130" font-size="8" fill="#2e7d32" text-anchor="middle">→ Liquid</text>

      <!-- Arrow 1→2 -->
      <line x1="145" y1="80" x2="175" y2="80" stroke="#0f4c81" stroke-width="1.5" marker-end="url(#arrow-cf)"/>

      <!-- Step 2: Push layer -->
      <rect x="180" y="20" width="120" height="120" rx="4" fill="#fff3e0" stroke="#e65100" stroke-width="1"/>
      <text x="240" y="40" font-size="9" font-weight="bold" fill="#e65100" text-anchor="middle">2. Push Layer</text>

      <rect x="195" y="55" width="90" height="25" rx="4" fill="#fff3e0" stroke="#e65100" stroke-width="2"/>
      <text x="240" y="72" font-size="7" fill="#e65100" text-anchor="middle">Water IS_A Gas</text>

      <rect x="195" y="85" width="90" height="25" rx="4" fill="#e1ecf7" stroke="#0f4c81" stroke-width="1"/>
      <text x="240" y="102" font-size="7" fill="#4a5670" text-anchor="middle">Water IS_A Liquid</text>

      <text x="240" y="125" font-size="7" fill="#e65100" text-anchor="middle">Hypothetical overrides</text>

      <!-- Arrow 2→3 -->
      <line x1="305" y1="80" x2="335" y2="80" stroke="#e65100" stroke-width="1.5" marker-end="url(#arrow-cf)"/>

      <!-- Step 3: Reason -->
      <rect x="340" y="20" width="120" height="120" rx="4" fill="#e8f5e9" stroke="#2e7d32" stroke-width="1"/>
      <text x="400" y="40" font-size="9" font-weight="bold" fill="#2e7d32" text-anchor="middle">3. Reason</text>

      <rect x="355" y="55" width="90" height="25" rx="4" fill="#fff3e0" stroke="#e65100" stroke-width="2"/>
      <text x="400" y="72" font-size="7" fill="#e65100" text-anchor="middle">Water IS_A Gas ✓</text>

      <rect x="355" y="85" width="90" height="25" rx="4" fill="#f5f5f5" stroke="#b0b6c4" stroke-width="1" stroke-dasharray="3,2"/>
      <text x="400" y="102" font-size="7" fill="#b0b6c4" text-anchor="middle">(hidden)</text>

      <text x="400" y="125" font-size="8" fill="#2e7d32" text-anchor="middle">→ Gas</text>

      <!-- Step 4: Pop layer -->
      <rect x="340" y="160" width="120" height="120" rx="4" fill="#f5f7fb" stroke="#b0b6c4" stroke-width="1"/>
      <text x="400" y="180" font-size="9" font-weight="bold" fill="#4a5670" text-anchor="middle">4. Pop Layer</text>

      <rect x="355" y="195" width="90" height="35" rx="4" fill="#e1ecf7" stroke="#0f4c81" stroke-width="2"/>
      <text x="400" y="210" font-size="8" font-weight="bold" fill="#0f4c81" text-anchor="middle">Base Knowledge</text>
      <text x="400" y="222" font-size="7" fill="#4a5670" text-anchor="middle">Water IS_A Liquid</text>

      <text x="400" y="255" font-size="8" fill="#4a5670" text-anchor="middle">ASK "Water IS_A ?"</text>
      <text x="400" y="270" font-size="8" fill="#2e7d32" text-anchor="middle">→ Liquid (restored)</text>

      <!-- Arrow 3→4 -->
      <line x1="400" y1="145" x2="400" y2="155" stroke="#2e7d32" stroke-width="1.5" marker-end="url(#arrow-cf)"/>

      <!-- Command panel -->
      <rect x="20" y="160" width="280" height="120" rx="4" fill="#f5f7fb" stroke="#b0b6c4" stroke-width="1"/>
      <text x="160" y="180" font-size="10" font-weight="bold" fill="#4a5670" text-anchor="middle">Sys2DSL Commands</text>

      <text x="35" y="200" font-size="9" fill="#4a5670" font-family="monospace">THEORY_PUSH name="what-if"</text>
      <text x="35" y="218" font-size="9" fill="#e65100" font-family="monospace">ASSERT Water IS_A Gas</text>
      <text x="35" y="236" font-size="9" fill="#2e7d32" font-family="monospace">ASK "Water IS_A ?" → Gas</text>
      <text x="35" y="254" font-size="9" fill="#4a5670" font-family="monospace">THEORY_POP</text>
      <text x="35" y="272" font-size="9" fill="#0f4c81" font-family="monospace">ASK "Water IS_A ?" → Liquid</text>
    </svg>
    <p class="diagram-caption">Counterfactual workflow: Push a hypothetical layer, add overriding facts, reason in the altered world, then pop to restore reality. The base knowledge is never modified—only temporarily shadowed by the hypothetical layer.</p>
  </div>

  <h2>How It Works</h2>

  <p>Counterfactuals use the <a href="../architecture/knowledge.html#theory-stack">TheoryStack</a> mechanism:</p>

  <ol>
    <li><strong>THEORY_PUSH</strong> – Create a new layer for hypothetical facts</li>
    <li><strong>ASSERT</strong> – Add counterfactual facts to the layer (these override base facts)</li>
    <li><strong>ASK / reason</strong> – Query the system; it sees the hypothetical world</li>
    <li><strong>THEORY_POP</strong> – Discard the layer; base knowledge is restored</li>
  </ol>

  <p>The key insight is that the base knowledge is never modified. The hypothetical layer simply intercepts queries and returns overriding answers.</p>

  <h2>Use Cases</h2>

  <table class="table-concept-index">
    <thead>
      <tr><th>Use Case</th><th>Example</th></tr>
    </thead>
    <tbody>
      <tr>
        <td>What-if analysis</td>
        <td>"If water were a gas at room temperature, could fish survive?"</td>
      </tr>
      <tr>
        <td>Policy simulation</td>
        <td>"If the tax rate were 20%, what would be the budget impact?"</td>
      </tr>
      <tr>
        <td>Debugging scenarios</td>
        <td>"If this config value were true, would the bug still occur?"</td>
      </tr>
      <tr>
        <td>Alternative history</td>
        <td>"If Rome had not fallen, what technologies might exist?"</td>
      </tr>
      <tr>
        <td>Safe experimentation</td>
        <td>Test knowledge changes before committing them</td>
      </tr>
    </tbody>
  </table>

  <h2>CF Syntax Shorthand</h2>

  <p>For simple counterfactuals, use the CF command:</p>

  <pre>
# Shorthand (push, assert, query, pop in one command)
CF "Water IS_A Gas?" | Water TEMPERATURE_AT Celsius200
# Temporarily assumes Water IS_A Gas and queries implications

# Expanded equivalent
THEORY_PUSH name="cf_temp"
ASSERT Water IS_A Gas
ASSERT Water TEMPERATURE_AT Celsius200
ASK "Can fish survive in Water?"
THEORY_POP</pre>

  <h2>Nested Counterfactuals</h2>

  <p>Multiple layers can be stacked for nested hypotheticals:</p>

  <pre>
THEORY_PUSH name="layer1"
ASSERT A IS_A B
  THEORY_PUSH name="layer2"
  ASSERT A IS_A C  # Overrides layer1's A IS_A B
  ASK "A IS_A ?"   # → C
  THEORY_POP
ASK "A IS_A ?"     # → B (layer1 still active)
THEORY_POP
ASK "A IS_A ?"     # → (original value)</pre>

  <h2>Related Documentation</h2>

  <ul>
    <li><a href="theory_layers.html">Theory Layers</a> – The underlying mechanism</li>
    <li><a href="../architecture/knowledge.html#theory-stack">TheoryStack</a> – Implementation details</li>
    <li><a href="non_monotonic_logic.html">Non-Monotonic Logic</a> – Belief revision</li>
    <li><a href="../syntax/index.html">Syntax Reference</a> – THEORY_PUSH, CF commands</li>
  </ul>

  <div class="footer-nav">
    <a href="analogy.html">← Analogy</a> ·
    <a href="theory_layers.html">Theory Layers →</a>
  </div>
  </div>
  <script src="../reference/nav2.js"></script>
</body>
</html>
