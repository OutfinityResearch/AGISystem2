<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Permutation Binding</title>
  <link rel="stylesheet" href="../reference/style.css">
</head>
<body>
  <div class="page">
  <div class="nav-header">
    <h1>AGISystem2 – Permutation Binding</h1>
    <small>
      <a href="../index.html">Home</a> ·
      <a href="../guides/conceptual_spaces.html">Theory</a> ·
      <a href="../architecture/index.html">Architecture</a> ·
      <a href="../api/index.html">APIs</a> ·
      <a href="../syntax/index.html">Syntax</a> ·
      <a href="../usage-cli/index.html">CLI</a> ·
      <a href="index.html">Wiki</a> ·
      <a href="../specs/matrix.html">Specs</a>
    </small>
  </div>

  <p>Permutation binding is the technique AGISystem2 uses to encode relations into vector representations. Each relation has a unique permutation that reorders the dimensions of the object vector before combining it with the subject. This encodes role information without increasing dimensionality.</p>

  <div class="diagram">
    <svg viewBox="0 0 560 260" role="img" aria-label="Permutation binding process">
      <defs>
        <marker id="arrow-pb" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto" markerUnits="strokeWidth">
          <path d="M0,0 L6,3 L0,6 z" fill="#0f4c81" />
        </marker>
      </defs>

      <!-- Background -->
      <rect x="0" y="0" width="560" height="260" fill="#fafbfc"/>

      <!-- Subject vector -->
      <rect x="20" y="80" width="100" height="50" rx="4" fill="#e1ecf7" stroke="#0f4c81" stroke-width="2"/>
      <text x="70" y="100" font-size="10" font-weight="bold" fill="#0f4c81" text-anchor="middle">v(Subject)</text>
      <text x="70" y="118" font-size="9" fill="#4a5670" text-anchor="middle">"Dog"</text>

      <!-- Object vector -->
      <rect x="20" y="150" width="100" height="50" rx="4" fill="#e8f5e9" stroke="#2e7d32" stroke-width="2"/>
      <text x="70" y="170" font-size="10" font-weight="bold" fill="#2e7d32" text-anchor="middle">v(Object)</text>
      <text x="70" y="188" font-size="9" fill="#4a5670" text-anchor="middle">"Animal"</text>

      <!-- Permutation box -->
      <rect x="160" y="150" width="100" height="50" rx="4" fill="#fff3e0" stroke="#e65100" stroke-width="2"/>
      <text x="210" y="170" font-size="10" font-weight="bold" fill="#e65100" text-anchor="middle">π_IS_A</text>
      <text x="210" y="188" font-size="9" fill="#4a5670" text-anchor="middle">permute dims</text>

      <!-- Permuted object -->
      <rect x="300" y="150" width="100" height="50" rx="4" fill="#e8f5e9" stroke="#2e7d32" stroke-width="2"/>
      <text x="350" y="170" font-size="10" font-weight="bold" fill="#2e7d32" text-anchor="middle">π(v(Object))</text>
      <text x="350" y="188" font-size="9" fill="#4a5670" text-anchor="middle">reordered</text>

      <!-- Addition symbol -->
      <circle cx="440" cy="130" r="20" fill="#f5f7fb" stroke="#0f4c81" stroke-width="2"/>
      <text x="440" y="136" font-size="18" fill="#0f4c81" text-anchor="middle">+</text>

      <!-- Result -->
      <rect x="480" y="105" width="60" height="50" rx="4" fill="#e1ecf7" stroke="#0f4c81" stroke-width="2"/>
      <text x="510" y="125" font-size="10" font-weight="bold" fill="#0f4c81" text-anchor="middle">Fact</text>
      <text x="510" y="143" font-size="9" fill="#4a5670" text-anchor="middle">vector</text>

      <!-- Arrows -->
      <line x1="120" y1="105" x2="418" y2="115" stroke="#0f4c81" stroke-width="1.5" marker-end="url(#arrow-pb)"/>
      <line x1="120" y1="175" x2="158" y2="175" stroke="#0f4c81" stroke-width="1.5" marker-end="url(#arrow-pb)"/>
      <line x1="260" y1="175" x2="298" y2="175" stroke="#e65100" stroke-width="1.5" marker-end="url(#arrow-pb)"/>
      <line x1="400" y1="175" x2="420" y2="145" stroke="#2e7d32" stroke-width="1.5" marker-end="url(#arrow-pb)"/>
      <line x1="460" y1="130" x2="478" y2="130" stroke="#0f4c81" stroke-width="1.5" marker-end="url(#arrow-pb)"/>

      <!-- Formula -->
      <rect x="140" y="20" width="280" height="40" rx="4" fill="#f5f7fb" stroke="#b0b6c4" stroke-width="1"/>
      <text x="280" y="45" font-size="12" fill="#0f4c81" text-anchor="middle">encode(S, R, O) = v(S) + π<tspan font-size="9" baseline-shift="sub">R</tspan>(v(O))</text>

      <!-- Legend -->
      <text x="20" y="240" font-size="9" fill="#4a5670">Different relations use different permutations: π_IS_A ≠ π_CAUSES ≠ π_LOCATED_IN</text>
    </svg>
    <p class="diagram-caption">Encoding a fact: The object vector is permuted according to the relation type, then added to the subject vector. Each relation (IS_A, CAUSES, etc.) has its own unique permutation table, encoding role information into the combined vector.</p>
  </div>

  <h2>Why Permutations?</h2>

  <p>The key insight is that permutation preserves vector properties (magnitude, sparsity) while creating a distinguishable representation. When you permute "Animal" with the IS_A permutation and add it to "Dog", you get a different vector than if you permuted "Animal" with CAUSES and added it. This lets the system distinguish "Dog IS_A Animal" from "Dog CAUSES Animal" using the same vector dimensionality.</p>

  <p>Permutations are also invertible. Given a fact vector and the subject vector, you can apply the inverse permutation to recover information about the object. This enables bidirectional reasoning: finding what a subject relates to, or finding what relates to a given object.</p>

  <h2>Implementation</h2>

  <p>The <a href="../architecture/geometry.html#relation-permuter">RelationPermuter</a> in the Geometry Layer manages permutation tables:</p>

  <table class="table-concept-index">
    <thead>
      <tr><th>Operation</th><th>Description</th></tr>
    </thead>
    <tbody>
      <tr>
        <td><code>permute(vector, relation)</code></td>
        <td>Apply forward permutation for encoding</td>
      </tr>
      <tr>
        <td><code>unpermute(vector, relation)</code></td>
        <td>Apply inverse permutation for decoding</td>
      </tr>
      <tr>
        <td><code>getPermutation(relation)</code></td>
        <td>Get the permutation table for a relation</td>
      </tr>
      <tr>
        <td><code>registerRelation(name, props)</code></td>
        <td>Add a custom relation with generated permutation</td>
      </tr>
    </tbody>
  </table>

  <p>Permutations are generated deterministically from the relation name using a seeded PRNG. This ensures reproducibility: the same relation always produces the same permutation across sessions and machines.</p>

  <h2>Relation Properties</h2>

  <p>Relations can have additional properties that affect how they're processed. See the <a href="../guides/relations.html">Relations Theory</a> page for details:</p>

  <ul>
    <li><strong>Inverse</strong> – IS_A has inverse HAS_INSTANCE; inverse permutations are computed automatically</li>
    <li><strong>Symmetric</strong> – SIMILAR_TO uses the same permutation in both directions</li>
    <li><strong>Transitive</strong> – IS_A chains are handled by the <a href="../architecture/reasoning.html">Reasoner</a></li>
  </ul>

  <h2>Related Documentation</h2>

  <ul>
    <li><a href="../guides/relations.html">Relations & Custom Verbs</a> – All relation types and how to define new ones</li>
    <li><a href="../architecture/geometry.html#relation-permuter">RelationPermuter</a> – Implementation in Geometry Layer</li>
    <li><a href="../architecture/language.html#encoder">Fact Encoder</a> – How facts are encoded using permutations</li>
    <li><a href="hyperdimensional_computing.html">Hyperdimensional Computing</a> – The theoretical foundation</li>
    <li><a href="../syntax/relations.html">Relations Syntax</a> – Command syntax for relations</li>
  </ul>

  <div class="footer-nav">
    <a href="index.html">← Wiki Index</a> ·
    <a href="../guides/relations.html">Relations Theory →</a>
  </div>
  </div>
  <script src="../reference/nav2.js"></script>
</body>
</html>
