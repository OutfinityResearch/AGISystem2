<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Auditability</title>
  <link rel="stylesheet" href="../reference/style.css">
</head>
<body>
  <div class="page">
  <div class="nav-header">
    <h1>AGISystem2 – Auditability</h1>
    <small>
      <a href="../index.html">Home</a> ·
      <a href="../guides/conceptual_spaces.html">Theory</a> ·
      <a href="../architecture/index.html">Architecture</a> ·
      <a href="../api/index.html">APIs</a> ·
      <a href="../syntax/index.html">Syntax</a> ·
      <a href="../usage-cli/index.html">CLI</a> ·
      <a href="index.html">Wiki</a> ·
      <a href="../specs/matrix.html">Specs</a>
    </small>
  </div>

  <p>Auditability in AGISystem2 means every reasoning step can be traced back to its inputs and rules. The <a href="../architecture/support.html">AuditLog</a> component records all operations with timestamps and provenance, creating an immutable trail for debugging, compliance, and trust.</p>

  <div class="diagram">
    <svg viewBox="0 0 560 360" role="img" aria-label="Audit trail provenance">
      <defs>
        <marker id="arrow-audit" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto" markerUnits="strokeWidth">
          <path d="M0,0 L6,3 L0,6 z" fill="#0f4c81" />
        </marker>
      </defs>

      <!-- Background -->
      <rect x="0" y="0" width="560" height="360" fill="#fafbfc"/>

      <!-- Query input -->
      <rect x="20" y="20" width="120" height="50" rx="4" fill="#e1ecf7" stroke="#0f4c81" stroke-width="2"/>
      <text x="80" y="40" font-size="9" font-weight="bold" fill="#0f4c81" text-anchor="middle">Query</text>
      <text x="80" y="55" font-size="8" fill="#4a5670" text-anchor="middle">ASK "Dog IS_A ?"</text>

      <!-- Arrow -->
      <line x1="145" y1="45" x2="175" y2="45" stroke="#0f4c81" stroke-width="1.5" marker-end="url(#arrow-audit)"/>

      <!-- Reasoning steps -->
      <rect x="180" y="15" width="200" height="60" rx="4" fill="#fff" stroke="#0f4c81" stroke-width="1"/>
      <text x="280" y="33" font-size="9" font-weight="bold" fill="#0f4c81" text-anchor="middle">Reasoning Steps</text>
      <text x="190" y="48" font-size="8" fill="#4a5670">1. Lookup Dog → vector v₁</text>
      <text x="190" y="60" font-size="8" fill="#4a5670">2. Find containment → Animal</text>
      <text x="190" y="72" font-size="8" fill="#4a5670">3. Return result</text>

      <!-- Arrow -->
      <line x1="385" y1="45" x2="415" y2="45" stroke="#0f4c81" stroke-width="1.5" marker-end="url(#arrow-audit)"/>

      <!-- Result -->
      <rect x="420" y="20" width="120" height="50" rx="4" fill="#e8f5e9" stroke="#2e7d32" stroke-width="2"/>
      <text x="480" y="40" font-size="9" font-weight="bold" fill="#2e7d32" text-anchor="middle">Result</text>
      <text x="480" y="55" font-size="8" fill="#4a5670" text-anchor="middle">Animal (0.95)</text>

      <!-- Audit log entries -->
      <rect x="20" y="95" width="520" height="180" rx="4" fill="#f5f7fb" stroke="#b0b6c4" stroke-width="1"/>
      <text x="280" y="115" font-size="10" font-weight="bold" fill="#4a5670" text-anchor="middle">Audit Log Entries</text>

      <!-- Entry 1 -->
      <rect x="35" y="125" width="490" height="40" rx="4" fill="#fff" stroke="#0f4c81" stroke-width="1"/>
      <text x="45" y="140" font-size="8" font-family="monospace" fill="#0f4c81">#001 | 2024-01-15T10:30:00Z | QUERY_START</text>
      <text x="45" y="155" font-size="8" fill="#4a5670">input: "ASK Dog IS_A ?" | context: layer=base | mask=full</text>

      <!-- Entry 2 -->
      <rect x="35" y="170" width="490" height="40" rx="4" fill="#fff" stroke="#0f4c81" stroke-width="1"/>
      <text x="45" y="185" font-size="8" font-family="monospace" fill="#0f4c81">#002 | 2024-01-15T10:30:00Z | CONTAINMENT_CHECK</text>
      <text x="45" y="200" font-size="8" fill="#4a5670">Dog.center ∈ Animal.diamond → TRUE | distance=42 | threshold=100</text>

      <!-- Entry 3 -->
      <rect x="35" y="215" width="490" height="40" rx="4" fill="#e8f5e9" stroke="#2e7d32" stroke-width="1"/>
      <text x="45" y="230" font-size="8" font-family="monospace" fill="#2e7d32">#003 | 2024-01-15T10:30:01Z | QUERY_RESULT</text>
      <text x="45" y="245" font-size="8" fill="#4a5670">result: Animal | confidence: 0.95 | steps: 2 | duration: 1ms</text>

      <!-- Audit features -->
      <rect x="20" y="290" width="520" height="55" rx="4" fill="#fff3e0" stroke="#e65100" stroke-width="1"/>
      <text x="280" y="310" font-size="10" font-weight="bold" fill="#e65100" text-anchor="middle">Audit Features</text>

      <rect x="35" y="320" width="115" height="20" rx="4" fill="#fff" stroke="#e65100" stroke-width="1"/>
      <text x="92" y="334" font-size="8" fill="#e65100" text-anchor="middle">Immutable log</text>

      <rect x="160" y="320" width="115" height="20" rx="4" fill="#fff" stroke="#e65100" stroke-width="1"/>
      <text x="217" y="334" font-size="8" fill="#e65100" text-anchor="middle">Hash chains</text>

      <rect x="285" y="320" width="115" height="20" rx="4" fill="#fff" stroke="#e65100" stroke-width="1"/>
      <text x="342" y="334" font-size="8" fill="#e65100" text-anchor="middle">Replay capability</text>

      <rect x="410" y="320" width="115" height="20" rx="4" fill="#fff" stroke="#e65100" stroke-width="1"/>
      <text x="467" y="334" font-size="8" fill="#e65100" text-anchor="middle">Export (JSON/CSV)</text>
    </svg>
    <p class="diagram-caption">Every query creates audit log entries that record the input, each reasoning step, and the final result. The log is immutable with hash chains for integrity. Any decision can be replayed to verify correctness or investigate issues.</p>
  </div>

  <h2>What Gets Logged</h2>

  <table class="table-concept-index">
    <thead>
      <tr><th>Event Type</th><th>Data Recorded</th><th>Purpose</th></tr>
    </thead>
    <tbody>
      <tr>
        <td>QUERY_START</td>
        <td>Input, context, active layers, mask</td>
        <td>Reproduce initial conditions</td>
      </tr>
      <tr>
        <td>CONCEPT_LOOKUP</td>
        <td>Name, vector hash, retrieval time</td>
        <td>Track data access</td>
      </tr>
      <tr>
        <td>CONTAINMENT_CHECK</td>
        <td>Concepts, distance, threshold, result</td>
        <td>Explain IS_A decisions</td>
      </tr>
      <tr>
        <td>BIAS_MASK_APPLIED</td>
        <td>Mask dimensions, context</td>
        <td>Fairness compliance</td>
      </tr>
      <tr>
        <td>PUSH/POP</td>
        <td>Layer name, facts added</td>
        <td>Counterfactual tracking</td>
      </tr>
      <tr>
        <td>QUERY_RESULT</td>
        <td>Output, confidence, duration</td>
        <td>Performance and correctness</td>
      </tr>
    </tbody>
  </table>

  <h2>Log Entry Structure</h2>

  <pre>
{
  "id": "a1b2c3d4",
  "timestamp": "2024-01-15T10:30:00.123Z",
  "event": "CONTAINMENT_CHECK",
  "data": {
    "subject": "Dog",
    "predicate": "IS_A",
    "object": "Animal",
    "distance": 42,
    "threshold": 100,
    "result": true
  },
  "context": {
    "queryId": "q789",
    "layer": "base",
    "mask": "full"
  },
  "prevHash": "abc123...",
  "hash": "def456..."
}</pre>

  <h2>Query Replay</h2>

  <p>Any logged query can be replayed to verify it produces the same result:</p>

  <pre>
// Get original query from audit log
const entry = auditLog.getEntry("q789");

// Replay with same context
const replayResult = reasoner.replay(entry);

// Verify deterministic behavior
assert(replayResult.equals(entry.result));
// If not equal, something changed (data, code, or corruption)</pre>

  <h2>Compliance Export</h2>

  <p>Audit logs can be exported for regulatory compliance:</p>

  <pre>
// Export all entries for a time range
auditLog.export({
  format: "json",        // or "csv"
  from: "2024-01-01",
  to: "2024-01-31",
  events: ["BIAS_MASK_APPLIED", "QUERY_RESULT"],
  output: "/reports/january-audit.json"
});</pre>

  <h2>Integrity Verification</h2>

  <p>Hash chains ensure the log hasn't been tampered with:</p>

  <pre>
// Verify entire log integrity
const valid = auditLog.verifyChain();
// Returns: { valid: true } or { valid: false, brokenAt: "entry#123" }

// Each entry's hash includes previous hash
hash(entry) = SHA256(entry.data + entry.prevHash)</pre>

  <h2>Related Documentation</h2>

  <ul>
    <li><a href="../architecture/support.html">Support Layer</a> – AuditLog implementation</li>
    <li><a href="bias.html">Bias Control</a> – Logged for fairness compliance</li>
    <li><a href="validation.html">Validation</a> – Validation failures are logged</li>
    <li><a href="theory_layers.html">Theory Layers</a> – Layer changes are tracked</li>
    <li><a href="trustworthy_ai.html">Trustworthy AI</a> – Auditability as trust foundation</li>
  </ul>

  <div class="footer-nav">
    <a href="validation.html">← Validation</a> ·
    <a href="trustworthy_ai.html">Trustworthy AI →</a>
  </div>
  </div>
  <script src="../reference/nav2.js"></script>
</body>
</html>
