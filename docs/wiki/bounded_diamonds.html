<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Bounded Diamonds</title>
  <link rel="stylesheet" href="../reference/style.css">
</head>
<body>
  <div class="page">
  <div class="nav-header">
    <h1>AGISystem2 – Bounded Diamonds</h1>
    <small>
      <a href="../index.html">Home</a> ·
      <a href="../guides/conceptual_spaces.html">Theory</a> ·
      <a href="../architecture/index.html">Architecture</a> ·
      <a href="../api/index.html">APIs</a> ·
      <a href="../syntax/index.html">Syntax</a> ·
      <a href="../usage-cli/index.html">CLI</a> ·
      <a href="index.html">Wiki</a> ·
      <a href="../specs/matrix.html">Specs</a>
    </small>
  </div>

  <p>A bounded diamond is the canonical shape used to represent concepts in AGISystem2. It combines an axis-aligned box (capturing hard constraints) with an L1 ball (capturing typicality gradients), producing a shape that models both necessary conditions and graded membership.</p>

  <div class="diagram">
    <svg viewBox="0 0 520 280" role="img" aria-label="Bounded diamond structure">
      <defs>
        <marker id="arrow-bd" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto" markerUnits="strokeWidth">
          <path d="M0,0 L6,3 L0,6 z" fill="#0f4c81" />
        </marker>
      </defs>

      <!-- Background -->
      <rect x="0" y="0" width="520" height="280" fill="#fafbfc"/>

      <!-- Left: 2D visualization -->
      <rect x="20" y="20" width="220" height="220" rx="4" fill="#f5f7fb" stroke="#b0b6c4" stroke-width="1"/>
      <text x="130" y="255" font-size="10" fill="#4a5670" text-anchor="middle">2D Projection</text>

      <!-- Axis-aligned box -->
      <rect x="50" y="50" width="160" height="160" fill="#e3f2fd" fill-opacity="0.4" stroke="#1976d2" stroke-width="2" stroke-dasharray="5,3"/>
      <text x="55" y="65" font-size="9" fill="#1976d2">Box (min/max)</text>

      <!-- L1 ball (diamond shape) -->
      <polygon points="130,60 200,130 130,200 60,130" fill="#e8f5e9" fill-opacity="0.5" stroke="#2e7d32" stroke-width="2"/>
      <text x="135" y="185" font-size="9" fill="#2e7d32">L1 Ball</text>

      <!-- Intersection = bounded diamond -->
      <polygon points="130,70 190,130 130,190 70,130" fill="#fff3e0" fill-opacity="0.7" stroke="#e65100" stroke-width="2"/>
      <text x="135" y="140" font-size="10" font-weight="bold" fill="#e65100">Bounded</text>
      <text x="135" y="152" font-size="10" font-weight="bold" fill="#e65100">Diamond</text>

      <!-- Center point -->
      <circle cx="130" cy="130" r="4" fill="#0f4c81"/>
      <text x="140" y="125" font-size="8" fill="#0f4c81">center</text>

      <!-- Radius indicator -->
      <line x1="130" y1="130" x2="190" y2="130" stroke="#4a5670" stroke-width="1" stroke-dasharray="2,2"/>
      <text x="160" y="118" font-size="8" fill="#4a5670">radius</text>

      <!-- Right: Structure breakdown -->
      <rect x="260" y="20" width="240" height="220" rx="4" fill="#f5f7fb" stroke="#b0b6c4" stroke-width="1"/>
      <text x="380" y="255" font-size="10" fill="#4a5670" text-anchor="middle">Data Structure</text>

      <!-- Center -->
      <rect x="280" y="40" width="200" height="35" rx="4" fill="#e1ecf7" stroke="#0f4c81" stroke-width="1"/>
      <text x="290" y="55" font-size="9" font-weight="bold" fill="#0f4c81">center: Int8Array(384)</text>
      <text x="290" y="68" font-size="8" fill="#4a5670">The prototype point of the concept</text>

      <!-- Min/Max -->
      <rect x="280" y="85" width="200" height="35" rx="4" fill="#e3f2fd" stroke="#1976d2" stroke-width="1"/>
      <text x="290" y="100" font-size="9" font-weight="bold" fill="#1976d2">min/max: Int8Array(384)</text>
      <text x="290" y="113" font-size="8" fill="#4a5670">Hard boundaries per dimension</text>

      <!-- Radius -->
      <rect x="280" y="130" width="200" height="35" rx="4" fill="#e8f5e9" stroke="#2e7d32" stroke-width="1"/>
      <text x="290" y="145" font-size="9" font-weight="bold" fill="#2e7d32">radius: number</text>
      <text x="290" y="158" font-size="8" fill="#4a5670">L1 distance from center</text>

      <!-- Mask -->
      <rect x="280" y="175" width="200" height="35" rx="4" fill="#fff3e0" stroke="#e65100" stroke-width="1"/>
      <text x="290" y="190" font-size="9" font-weight="bold" fill="#e65100">mask: Uint8Array(384)</text>
      <text x="290" y="203" font-size="8" fill="#4a5670">Which dimensions are relevant</text>
    </svg>
    <p class="diagram-caption">A bounded diamond is the intersection of a box and an L1 ball. The box defines hard min/max constraints per dimension. The L1 ball defines a typicality gradient around the center. The mask specifies which dimensions matter for this concept.</p>
  </div>

  <h2>How It Works</h2>

  <p>When the system receives a new fact about a concept, the <a href="../architecture/knowledge.html#cluster-manager">ClusterManager</a> decides whether to expand an existing diamond or create a new one. Expansion involves adjusting the center, widening the box boundaries, or increasing the radius. If the new point is too far from any existing diamond, a fresh diamond is created.</p>

  <p>Containment testing checks whether a query point falls inside a diamond. A point is inside if: (1) it satisfies all box constraints (each dimension within min/max), and (2) the masked L1 distance from the center is within the radius. This two-part check models both hard categorical boundaries and soft typicality.</p>

  <p>The mask allows context-sensitive reasoning. When comparing concepts in a domain-specific context, irrelevant dimensions can be masked out. For example, comparing animals by behavior might mask color dimensions. The <a href="masked_l1_distance.html">Masked L1 Distance</a> wiki page explains this in detail.</p>

  <h2>Implementation in AGISystem2</h2>

  <p>The <code>BoundedDiamond</code> class in the <a href="../architecture/geometry.html#bounded-diamond">Geometry Layer</a> provides the core operations:</p>

  <table class="table-concept-index">
    <thead>
      <tr><th>Operation</th><th>Description</th></tr>
    </thead>
    <tbody>
      <tr>
        <td><code>contains(point)</code></td>
        <td>Check if point is inside the diamond</td>
      </tr>
      <tr>
        <td><code>distance(point)</code></td>
        <td>Compute masked L1 distance to center</td>
      </tr>
      <tr>
        <td><code>expand(point)</code></td>
        <td>Grow to include a new point</td>
      </tr>
      <tr>
        <td><code>intersects(other)</code></td>
        <td>Check if two diamonds overlap</td>
      </tr>
      <tr>
        <td><code>union(other)</code></td>
        <td>Create diamond covering both regions</td>
      </tr>
    </tbody>
  </table>

  <h2>Why This Shape?</h2>

  <p>Bounded diamonds balance expressiveness with efficiency. Boxes alone cannot model typicality gradients. L1 balls alone cannot enforce hard per-dimension constraints. The intersection gives both: hard boundaries where needed, soft gradients where appropriate. Additionally, L1 geometry (Manhattan distance) works well with int8 arithmetic and avoids the precision issues of Euclidean distance.</p>

  <h2>Related Documentation</h2>

  <ul>
    <li><a href="../architecture/geometry.html#bounded-diamond">BoundedDiamond Implementation</a> – Technical details in Geometry Layer</li>
    <li><a href="../architecture/knowledge.html#cluster-manager">ClusterManager</a> – How diamonds are created and expanded</li>
    <li><a href="masked_l1_distance.html">Masked L1 Distance</a> – The distance metric used</li>
    <li><a href="../guides/conceptual_spaces.html">Conceptual Spaces Theory</a> – Why concepts are regions</li>
    <li><a href="hyperdimensional_computing.html">Hyperdimensional Computing</a> – The vector space foundation</li>
  </ul>

  <div class="footer-nav">
    <a href="index.html">← Wiki Index</a> ·
    <a href="masked_l1_distance.html">Masked L1 Distance →</a>
  </div>
  </div>
  <script src="../reference/nav2.js"></script>
</body>
</html>
