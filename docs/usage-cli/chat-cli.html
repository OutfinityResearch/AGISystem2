<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Chat Interface</title>
  <link rel="stylesheet" href="../reference/style.css">
</head>
<body>
  <div class="page">
  <div class="nav-header">
    <h1>AGISystem2 – Chat Interface</h1>
    <small>
      <a href="../index.html">Home</a> ·
      <a href="../guides/conceptual_spaces.html">Theory</a> ·
      <a href="../architecture/index.html">Architecture</a> ·
      <a href="../api/index.html">APIs</a> ·
      <a href="../syntax/index.html">Syntax</a> ·
      <a href="index.html">CLI</a> ·
      <a href="../wiki/index.html">Wiki</a> ·
      <a href="../specs/matrix.html">Specs</a>
    </small>
    <div class="sub-nav">
      <strong>CLI Topics:</strong>
      <a href="index.html">Overview</a> ·
      <a href="raw-cli.html">Raw CLI</a> ·
      <a href="chat-cli.html">Chat Interface</a>
    </div>
  </div>

  <p>The Chat Interface (<code>AGISystem2.sh</code>) provides a natural language front-end to AGISystem2. It uses an LLM (Large Language Model) to translate your conversational input into the structured Sys2DSL commands that the engine understands. This makes it ideal for exploration, demonstration, and working with domain experts who don't need to learn the formal syntax.</p>

  <div class="diagram">
    <svg viewBox="0 0 520 180" role="img" aria-label="Chat interface architecture showing LLM translation">
      <defs>
        <marker id="arrow-chat" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto" markerUnits="strokeWidth">
          <path d="M0,0 L6,3 L0,6 z" fill="#2e7d32" />
        </marker>
      </defs>

      <!-- User input -->
      <rect x="10" y="60" width="90" height="60" rx="6" fill="#f5f7fb" stroke="#2e7d32" stroke-width="2"/>
      <text x="55" y="82" font-size="9" font-weight="bold" fill="#2e7d32" text-anchor="middle">Natural</text>
      <text x="55" y="95" font-size="9" font-weight="bold" fill="#2e7d32" text-anchor="middle">Language</text>
      <text x="55" y="110" font-size="7" fill="#4a5670" text-anchor="middle">"Dogs are animals"</text>

      <!-- LLM -->
      <rect x="130" y="50" width="100" height="80" rx="8" fill="#e8f5e9" stroke="#2e7d32" stroke-width="2"/>
      <text x="180" y="75" font-size="10" font-weight="bold" fill="#2e7d32" text-anchor="middle">LLM Agent</text>
      <text x="180" y="90" font-size="7" fill="#4a5670" text-anchor="middle">Intent Detection</text>
      <text x="180" y="102" font-size="7" fill="#4a5670" text-anchor="middle">Fact Extraction</text>
      <text x="180" y="114" font-size="7" fill="#4a5670" text-anchor="middle">Response Generation</text>

      <!-- Sys2DSL -->
      <rect x="260" y="60" width="90" height="60" rx="6" fill="#e1ecf7" stroke="#0f4c81" stroke-width="2"/>
      <text x="305" y="82" font-size="9" font-weight="bold" fill="#0f4c81" text-anchor="middle">Sys2DSL</text>
      <text x="305" y="95" font-size="9" font-weight="bold" fill="#0f4c81" text-anchor="middle">Commands</text>
      <text x="305" y="110" font-size="7" fill="#4a5670" text-anchor="middle">ASSERT Dog IS_A...</text>

      <!-- Engine -->
      <rect x="380" y="50" width="90" height="80" rx="8" fill="#e1ecf7" stroke="#0f4c81" stroke-width="2"/>
      <text x="425" y="75" font-size="10" font-weight="bold" fill="#0f4c81" text-anchor="middle">AGISystem2</text>
      <text x="425" y="90" font-size="8" fill="#4a5670" text-anchor="middle">Engine</text>
      <text x="425" y="105" font-size="7" fill="#4a5670" text-anchor="middle">Reasoning</text>
      <text x="425" y="117" font-size="7" fill="#4a5670" text-anchor="middle">Storage</text>

      <!-- Arrows -->
      <line x1="100" y1="90" x2="128" y2="90" stroke="#2e7d32" stroke-width="1.5" marker-end="url(#arrow-chat)"/>
      <line x1="230" y1="90" x2="258" y2="90" stroke="#0f4c81" stroke-width="1.5" marker-end="url(#arrow-chat)"/>
      <line x1="350" y1="90" x2="378" y2="90" stroke="#0f4c81" stroke-width="1.5" marker-end="url(#arrow-chat)"/>

      <!-- Return path -->
      <path d="M 425 130 L 425 160 L 55 160 L 55 122" fill="none" stroke="#2e7d32" stroke-width="1" stroke-dasharray="4,2" marker-end="url(#arrow-chat)"/>
      <text x="240" y="155" font-size="7" fill="#4a5670" text-anchor="middle">Natural language response</text>
    </svg>
    <p class="diagram-caption">The Chat Interface translates natural language through an LLM into Sys2DSL commands, executes them in the AGISystem2 engine, and converts results back to natural language.</p>
  </div>

  <h2>Requirements</h2>

  <p>The Chat Interface requires:</p>
  <ul>
    <li><strong>Node.js 18+</strong> – For running the JavaScript engine</li>
    <li><strong>AchillesAgentLib</strong> – The LLM integration library (auto-discovered in common locations)</li>
    <li><strong>LLM API Key</strong> – At least one of:
      <ul>
        <li><code>OPENAI_API_KEY</code> – For OpenAI models (GPT-4, GPT-4o-mini)</li>
        <li><code>ANTHROPIC_API_KEY</code> – For Claude models</li>
        <li><code>GEMINI_API_KEY</code> – For Google Gemini models</li>
        <li><code>OPENROUTER_API_KEY</code> – For OpenRouter proxy</li>
      </ul>
    </li>
  </ul>

  <p>API keys can be set in your shell environment or in a <code>.env</code> file in your working directory or any parent directory.</p>

  <h2>Starting the Chat</h2>

  <pre>
# Set API key (or use .env file)
export OPENAI_API_KEY="sk-your-key-here"

# Start chat
./bin/AGISystem2.sh

# With debug output
./bin/AGISystem2.sh --debug

# Without colors
./bin/AGISystem2.sh --no-color</pre>

  <p>On startup, the interface shows which LLM providers are configured:</p>

  <pre>
╔════════════════════════════════════════════════════════════╗
║              AGISystem2 Chat Interface                     ║
║        Natural Language Knowledge Reasoning                 ║
╚════════════════════════════════════════════════════════════╝

Initializing...
✓ AGISystem2 Chat initialized. LLM providers: OpenAI

Type /help for commands, or just start chatting!

You: </pre>

  <h2>Basic Usage</h2>

  <h3>Teaching Facts</h3>
  <p>Simply state facts in natural language. The LLM extracts Subject-Relation-Object triples:</p>

  <pre>
You: Dogs are mammals
AI: Got it! I've learned 1 fact(s):
    - Dog IS_A Mammal

You: Fire causes smoke and heat
AI: Got it! I've learned 2 fact(s):
    - Fire CAUSES Smoke
    - Fire CAUSES Heat

You: Paris is located in France, which is in Europe
AI: Got it! I've learned 2 fact(s):
    - Paris LOCATED_IN France
    - France LOCATED_IN Europe</pre>

  <h3>Asking Questions</h3>
  <p>Ask questions naturally. The system determines the query type and responds conversationally:</p>

  <pre>
You: Is a dog a mammal?
AI: Yes, that appears to be true based on what I know.

You: What causes smoke?
AI: Based on the facts I have, Fire causes Smoke.

You: Tell me about Paris
AI: Here's what I know about Paris:
    - Paris LOCATED_IN France</pre>

  <h3>REPL Commands</h3>
  <p>Special commands starting with <code>/</code> provide direct control:</p>

  <table class="command-table">
    <thead>
      <tr><th>Command</th><th>Description</th></tr>
    </thead>
    <tbody>
      <tr><td><code>/help</code></td><td>Show help information</td></tr>
      <tr><td><code>/facts</code></td><td>List all known facts</td></tr>
      <tr><td><code>/concepts</code></td><td>List all concepts</td></tr>
      <tr><td><code>/theories</code></td><td>Show theory stack</td></tr>
      <tr><td><code>/history</code></td><td>Show conversation history</td></tr>
      <tr><td><code>/clear</code></td><td>Clear conversation history</td></tr>
      <tr><td><code>/exit</code></td><td>Exit the chat</td></tr>
    </tbody>
  </table>

  <h2>Advanced Features</h2>

  <h3>Theory Management</h3>
  <p>Create, switch, and save theory branches through conversation:</p>

  <pre>
You: Create a new theory called medical_facts
AI: Created new theory branch: "medical_facts". All new facts will be added to this context.

You: Aspirin reduces inflammation
AI: Got it! I've learned 1 fact(s):
    - Aspirin REDUCES Inflammation

You: List theories
AI: Current theory stack:
    { "depth": 1, "name": "medical_facts" }

You: Save theory as medical_v1
AI: Saved theory "medical_v1" to .AGISystem2/theories/medical_v1.sys2dsl

You: Pop theory
AI: Discarded current theory layer. Returned to previous context.</pre>

  <h3>Importing Files</h3>
  <p>Import facts from text files:</p>

  <pre>
You: Import file my_knowledge.txt
AI: Imported 15 facts from my_knowledge.txt</pre>

  <p>The file should contain facts in natural language, one per line. Comments start with <code>#</code>.</p>

  <h3>Contradiction Detection</h3>
  <p>The system automatically detects when new facts might contradict existing knowledge:</p>

  <pre>
You: Dogs are reptiles
AI: I noticed potential contradictions with existing knowledge:
    - Dog was previously classified as Mammal, which is different from Reptile

    Would you like me to create a new theory branch?
    Suggested name: "alternative_classification"</pre>

  <h2>How It Works Internally</h2>

  <p>The Chat Interface follows this processing pipeline:</p>

  <ol>
    <li><strong>Intent Detection</strong> – The LLM analyzes your message to determine intent:
      <ul>
        <li><code>teach</code> – You're stating facts to learn</li>
        <li><code>ask</code> – You're asking a question</li>
        <li><code>import</code> – You want to import a file</li>
        <li><code>manage_theory</code> – You want to create/switch theories</li>
        <li><code>list</code> – You want to see facts/concepts/theories</li>
      </ul>
    </li>
    <li><strong>Processing</strong> – Based on intent, specialized handlers process the request:
      <ul>
        <li>For teaching: LLM extracts facts as S-R-O triples, contradiction check, then ASSERT commands</li>
        <li>For questions: LLM parses to canonical form, ASK command executed, result converted to natural language</li>
      </ul>
    </li>
    <li><strong>Response Generation</strong> – Results are converted back to natural language for the user</li>
  </ol>

  <p>See <a href="../architecture/dsl-engine.html">DS(/theory/dsl_engine)</a> for details on command execution, and <a href="../architecture/chat-engine.html">DS(/chat/chat_engine)</a> for the chat-specific processing logic.</p>

  <h2>Relation Mapping</h2>

  <p>The LLM maps natural language to these core relations:</p>

  <table class="relation-table">
    <thead>
      <tr><th>Natural Language</th><th>Relation</th><th>Example</th></tr>
    </thead>
    <tbody>
      <tr><td>"is a", "are", "is a type of"</td><td>IS_A</td><td>Dog IS_A Mammal</td></tr>
      <tr><td>"has", "contains", "includes"</td><td>HAS_PROPERTY</td><td>Water HAS_PROPERTY liquid</td></tr>
      <tr><td>"causes", "leads to", "results in"</td><td>CAUSES</td><td>Fire CAUSES Smoke</td></tr>
      <tr><td>"is caused by", "comes from"</td><td>CAUSED_BY</td><td>Smoke CAUSED_BY Fire</td></tr>
      <tr><td>"is in", "is located in"</td><td>LOCATED_IN</td><td>Paris LOCATED_IN France</td></tr>
      <tr><td>"requires", "needs"</td><td>REQUIRES</td><td>Driving REQUIRES License</td></tr>
      <tr><td>"allows", "permits"</td><td>PERMITS</td><td>License PERMITS Driving</td></tr>
      <tr><td>"prohibits", "forbids"</td><td>PROHIBITED_BY</td><td>Speeding PROHIBITED_BY Law</td></tr>
    </tbody>
  </table>

  <p>For the full list of relations, see the <a href="../syntax/relations.html">Relations Reference</a>.</p>

  <h2>Limitations</h2>

  <ul>
    <li><strong>Non-deterministic</strong> – LLM responses vary; the same input may produce slightly different fact extractions</li>
    <li><strong>API costs</strong> – Each interaction requires LLM API calls, which have usage costs</li>
    <li><strong>Latency</strong> – LLM calls add 1-3 seconds to each interaction</li>
    <li><strong>Extraction accuracy</strong> – Complex or ambiguous statements may not extract correctly</li>
    <li><strong>Interactive only</strong> – No batch mode; use the <a href="raw-cli.html">Raw CLI</a> for automation</li>
  </ul>

  <h2>Environment Configuration</h2>

  <p>The Chat Interface auto-discovers the AchillesAgentLib library in these locations:</p>

  <ul>
    <li>Sibling directory: <code>../AchillesAgentLib/</code></li>
    <li>HOME directory: <code>~/work/AchillesAgentLib/</code></li>
    <li>NODE_PATH directories</li>
    <li>npm global modules</li>
  </ul>

  <p>If the library isn't found, set NODE_PATH explicitly:</p>

  <pre>
export NODE_PATH="/path/to/AchillesAgentLib/parent:$NODE_PATH"
./bin/AGISystem2.sh</pre>

  <p>Use <code>--debug</code> to see which paths are being searched and which library is loaded.</p>

  <div class="footer-nav">
    <a href="index.html">CLI Overview</a> ·
    <a href="raw-cli.html">Raw CLI</a> ·
    <a href="../api/index.html">Library API</a>
  </div>
  </div>
  <script src="../reference/nav2.js"></script>
</body>
</html>
