<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Syntax – Sys2DSL</title>
  <link rel="stylesheet" href="../reference/style.css">
</head>
<body>
  <div class="page">
  <div class="nav-header">
    <h1>Sys2DSL: Session &amp; Theory Scripts</h1>
  </div>

  <p>Sys2DSL is the textual language used to describe all reasoning logic in an AGISystem2 session or theory file. There is no separate macro language: a theory is simply a multi‑line Sys2DSL programme.</p>

  <h2>Basic Line Form (v3.0)</h2>
  <p>In Sys2DSL v3.0, every instruction is a single triple of the form:</p>
  <pre><code>@varName Subject VERB Object</code></pre>

  <ul>
    <li><code>@varName</code> defines a variable name in the script environment (for example <code>@f1</code>, <code>@q1</code>, <code>@mask</code>). Use <code>@_</code> when you do not need the result.</li>
    <li><code>Subject</code> is a concept, fact, or variable reference (for example <code>Dog</code>, <code>animal</code>, <code>$result</code>).</li>
    <li><code>VERB</code> is an ALL_CAPS relation or operation (for example <code>IS_A</code>, <code>HAS</code>, <code>FACTS</code>, <code>QUERY</code>, <code>PROVE</code>).</li>
    <li><code>Object</code> is a concept, fact, wildcard <code>any</code>, variable, number, or string literal.</li>
  </ul>

  <p>Comments are lines starting with <code>#</code> and are ignored. Extra spaces between tokens are allowed. There are no variable‑arity “commands” in v3.0: everything is expressed as <code>@var Subject VERB Object</code>.</p>

  <h2>Tokens and Variables</h2>
  <p>Conventions for tokens in arguments:</p>
  <ul>
    <li>words starting with a lowercase letter (<code>animal</code>, <code>water</code>, <code>export_data</code>) – concept names;</li>
    <li>words starting with an uppercase letter (<code>Dog</code>, <code>Alice</code>, <code>CityX</code>) – individuals or concrete instances (facts);</li>
    <li>words starting with <code>$</code> (<code>$reqs</code>, <code>$list</code>) – references to variables defined earlier (via <code>@reqs</code>, <code>@list</code>);</li>
    <li>double‑quoted strings – complete texts (for example questions or search patterns) that may contain spaces, <code>?</code>, <code>=</code> etc.</li>
  </ul>

  <p>Variables are bound at the time the instruction that defines them is executed. Any instruction that uses <code>$name</code> depends on the instruction that defined <code>@name</code>.</p>

  <h2>Statements and Topological Evaluation</h2>
  <p>A Sys2DSL script is a list of instructions. Statements are delimited as follows:</p>
  <ul>
    <li>each occurrence of <code>@</code> that starts a word marks the beginning of a new statement;</li>
    <li>you may write a single instruction per line or several instructions on the same line, as long as each starts with its own <code>@</code>:</li>
  </ul>

  <pre><code>@_ Dog IS_A Animal
@_ Water BOILS_AT Celsius100
@_ Celsius100 IS_A temperature
@q1 Dog IS_A Animal
@q2 any IS_A animal</code></pre>

  <pre><code>@_ Dog IS_A Animal @q1 Dog IS_A Animal</code></pre>

  <p>Instead of executing lines strictly in textual order, the interpreter first builds a dependency graph between variables (based on <code>$name</code> occurrences) and evaluates instructions in a topological order. This allows you to write:</p>

  <pre><code>@list Dog FACTS any
@a $list NONEMPTY any
@b $a BOOL_AND $a</code></pre>

  <p>even though <code>@b</code> appears first textually; the engine will evaluate <code>@list</code> first, then <code>@a</code>, then <code>@b</code>. Cyclic dependencies (for example <code>@a</code> depending on <code>$b</code> and <code>@b</code> on <code>$a</code>) are detected and reported as errors.</p>

  <h2>Verb Categories</h2>
  <p>Sys2DSL verbs are organized into functional categories. See DS(/theory/Sys2DSL_commands) and the split specs it references for the complete v3.0 verb list.</p>

  <h3>Query Verbs</h3>
  <pre><code>@q1 Dog IS_A animal                      # Truth value via IS_A
@q2 any IS_A animal                       # Enumerate all animals
@facts Dog FACTS any                      # Pattern search
@result Dog QUERY animal                  # High-level query</code></pre>

  <h3>Assertion / Update Verbs</h3>
  <pre><code>@_ Dog IS_A animal
@_ Water BOILS_AT Celsius100
@_ misconception RETRACT any              # Remove a fact</code></pre>

  <h3>Reasoning Verbs</h3>
  <pre><code>@proof Dog PROVE LivingThing              # Prove with chain
@valid any VALIDATE any                   # Check consistency
@hyp Smoke HYPOTHESIZE any                # Generate hypotheses
@cfResult Query CF "Water IS_A gas? | Water BOILS_AT Celsius150"
@abd Smoke ABDUCT CAUSES                  # Abductive reasoning</code></pre>

  <h3>Theory Layer Verbs</h3>
  <pre><code>@_ exploration PUSH any                   # Push new layer
@_ any POP any                            # Pop and discard
@stack any THEORIES any                   # Show layer stack
@load physics_basics LOAD any             # Load from storage
@save my_domain SAVE any                  # Save to storage</code></pre>

  <h3>Memory Management Verbs</h3>
  <pre><code>@stats Water USAGE any                    # Usage statistics
@_ ImportantConcept PROTECT any           # Protect from forgetting
@_ TempConcept UNPROTECT any              # Remove protection
@_ OldFact FORGET any                     # Remove low‑value facts
@_ Water BOOST any                        # Increase priority</code></pre>

  <h3>Mask Verbs</h3>
  <pre><code>@m1 ontology MASK any                      # By partition
@m2 Temperature_Mass MASK any             # By dimensions
@q2 Dog QUERY_MASKED $m1 animal           # Query with mask (pattern)</code></pre>

  <h3>Utility Verbs</h3>
  <pre><code>@and $q1 BOOL_AND $q2                     # Boolean AND
@or $q1 BOOL_OR $q2                       # Boolean OR
@not $q1 BOOL_NOT any                     # Boolean NOT
@merged $list1 MERGE_LISTS $list2         # Combine lists
@first $list PICK_FIRST any               # First element
@n $list COUNT any                        # List size
@nonEmpty $list NONEMPTY any              # Check if non-empty</code></pre>

  <h3>Output Verbs</h3>
  <pre><code>@text $result TO_NATURAL any              # Human-readable
@json $result TO_JSON any                 # JSON export
@summary $list SUMMARIZE any              # Summarize list</code></pre>

  <h2>Complete Example</h2>
  <p>A compliance check programme in strict triple syntax (adapted from DS(/theory/dsl_engine.js)):</p>
  <pre><code># Fetch procedure requirements and satisfied requirements
@reqs    $procId FACTS REQUIRES
@givenAll any FACTS GIVEN
@satGiven $givenAll FILTER yes
@presentAll any FACTS PRESENT
@satPresent $presentAll FILTER yes
@allSat  $satGiven MERGE_LISTS $satPresent
@result  $reqs ALL_REQUIREMENTS_SATISFIED $allSat</code></pre>

  <h2>Sys2DSL in Theory Files vs. Sessions</h2>
  <p>The same language is used in two contexts:</p>
  <ul>
    <li><strong>Theory files</strong> – text files (for example <code>*.sys2dsl</code>) versioned in Git, containing reusable Sys2DSL programmes for a domain (health rules, export rules, narratives, etc.).</li>
    <li><strong>Session scripts</strong> – strings or arrays of lines sent to a <code>System2Session</code> to add facts, run checks or explore counterfactuals.</li>
  </ul>

  <p>There is no syntax difference between the two; only the loading method differs (persistent files vs. commands sent via API/CLI).</p>

  <h2>Summary</h2>
  <p>Sys2DSL is the only textual‑level language used to talk to AGISystem2. Facts, questions and verification programmes are all expressed as sequences of <code>@var Subject VERB Object</code> triple instructions, evaluated in a deterministic and easily auditable way.</p>

  <h2>References</h2>
  <p>For implementation details, see the relevant design specifications (referenced by ID):</p>
  <ul>
    <li>DS[/theory/dsl_engine.js] – Sys2DSL interpreter and triple execution model.</li>
    <li>DS[/theory/Sys2DSL-grammar.md] – strict v3.0 grammar (<code>@var Subject VERB Object</code>).</li>
    <li>DS[/theory/topological_eval]</li>
    <li>DS[/interface/system2_session.js]</li>
  </ul>

  <div class="footer-nav">
    <a href="index.html">Back to Syntax overview</a>
    <a href="../index.html">Back to index</a>
  </div>
  </div>
  <script src="nav.js"></script>
</body>
</html>
