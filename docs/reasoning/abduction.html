<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Abduction Engine - AGISystem2</title>
  <link rel="stylesheet" href="../reference/style.css">
  <style>
    .math-box { background: #e3f2fd; border-left: 4px solid #1976d2; padding: 15px 20px; margin: 15px 0; border-radius: 0 8px 8px 0; }
    .algorithm-box { background: #f3e5f5; border-left: 4px solid #9c27b0; padding: 15px 20px; margin: 15px 0; border-radius: 0 8px 8px 0; }
    .example-box { background: #e8f5e9; border-left: 4px solid #4caf50; padding: 15px 20px; margin: 15px 0; border-radius: 0 8px 8px 0; }
    .warning-box { background: #fff3e0; border-left: 4px solid #ef6c00; padding: 15px 20px; margin: 15px 0; border-radius: 0 8px 8px 0; }
    h2 { border-bottom: 2px solid #9c27b0; padding-bottom: 10px; margin-top: 40px; }
    .equation { text-align: center; font-size: 18px; margin: 20px 0; font-family: 'Times New Roman', serif; }
  </style>
</head>
<body>
  <div class="page">
  <div class="nav-header">
    <h1>Abduction Engine</h1>
    <small>
      <a href="../index.html">Home</a> ·
      <a href="index.html">Reasoning</a> ·
      <a href="proof-engine.html">Proof</a> ·
      <a href="query-engine.html">Query</a>
    </small>
    <small>Finding explanations for observed facts</small>
  </div>

  <div class="section-intro">
    <p><strong>Abduction</strong> is inference to the best explanation. Given an observation O, abduction finds hypotheses H such that if H were true, O would be explained. Unlike deduction (proving what must be true), abduction asks "what <em>could</em> explain this?"</p>
  </div>

  <h2>1. Theoretical Foundation</h2>

  <div class="math-box">
    <p><strong>The Three Modes of Inference:</strong></p>
    <table style="width: 100%; margin: 15px 0;">
      <tr>
        <td><strong>Deduction:</strong></td>
        <td>Rule + Case → Result</td>
        <td>"All men are mortal. Socrates is a man. ∴ Socrates is mortal."</td>
      </tr>
      <tr>
        <td><strong>Induction:</strong></td>
        <td>Case + Result → Rule</td>
        <td>"Socrates is mortal. Socrates is a man. ∴ All men are mortal."</td>
      </tr>
      <tr>
        <td><strong>Abduction:</strong></td>
        <td>Rule + Result → Case</td>
        <td>"All men are mortal. Socrates is mortal. ∴ Socrates is a man."</td>
      </tr>
    </table>
  </div>

  <div class="math-box">
    <p><strong>Formal Definition:</strong></p>
    <div class="equation">
      abduce(O, KB) = { H | KB ∪ {H} ⊢ O, KB ⊬ ¬H }
    </div>
    <p>A hypothesis H is a valid explanation if:</p>
    <ul>
      <li>Adding H to KB allows O to be derived</li>
      <li>H is consistent with KB (not contradicted)</li>
    </ul>
  </div>

  <div class="warning-box">
    <p><strong>Fallacy Warning:</strong> Abduction is not logically valid! "If it rains, the ground is wet" + "The ground is wet" does NOT prove it rained (sprinklers exist). Abduction finds <em>possible</em> explanations, not certain ones.</p>
  </div>

  <h2>2. Abduction Process</h2>

  <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; margin: 20px 0;">
    <svg viewBox="0 0 700 320" style="width: 100%; max-width: 800px; display: block; margin: 0 auto;">
      <!-- Title -->
      <text x="350" y="20" text-anchor="middle" font-size="14" font-weight="bold" fill="#333">Abduction Process Flow</text>

      <!-- Observation -->
      <rect x="275" y="40" width="150" height="45" rx="8" fill="#c62828"/>
      <text x="350" y="58" text-anchor="middle" font-size="11" fill="white" font-weight="bold">Observation</text>
      <text x="350" y="75" text-anchor="middle" font-size="10" fill="#ffcdd2">O: "The grass is wet"</text>

      <!-- Arrow down -->
      <path d="M350 85 L350 110" stroke="#546e7a" stroke-width="2" marker-end="url(#abdArrow)"/>

      <!-- Find rules box -->
      <rect x="225" y="115" width="250" height="40" rx="6" fill="#7b1fa2"/>
      <text x="350" y="140" text-anchor="middle" font-size="11" fill="white">Find rules where O is consequent</text>

      <!-- Arrow down split -->
      <path d="M350 155 L350 175" stroke="#546e7a" stroke-width="2"/>
      <path d="M350 175 L150 175 L150 200" stroke="#546e7a" stroke-width="2" marker-end="url(#abdArrow)"/>
      <path d="M350 175 L350 200" stroke="#546e7a" stroke-width="2" marker-end="url(#abdArrow)"/>
      <path d="M350 175 L550 175 L550 200" stroke="#546e7a" stroke-width="2" marker-end="url(#abdArrow)"/>

      <!-- Hypothesis 1 -->
      <rect x="50" y="205" width="200" height="50" rx="6" fill="#e3f2fd" stroke="#1976d2" stroke-width="2"/>
      <text x="150" y="225" text-anchor="middle" font-size="10" font-weight="bold" fill="#1565c0">H₁: It rained</text>
      <text x="150" y="242" text-anchor="middle" font-size="9" fill="#1565c0">Rule: rain → wet grass</text>

      <!-- Hypothesis 2 -->
      <rect x="250" y="205" width="200" height="50" rx="6" fill="#e3f2fd" stroke="#1976d2" stroke-width="2"/>
      <text x="350" y="225" text-anchor="middle" font-size="10" font-weight="bold" fill="#1565c0">H₂: Sprinklers on</text>
      <text x="350" y="242" text-anchor="middle" font-size="9" fill="#1565c0">Rule: sprinklers → wet grass</text>

      <!-- Hypothesis 3 -->
      <rect x="450" y="205" width="200" height="50" rx="6" fill="#e3f2fd" stroke="#1976d2" stroke-width="2"/>
      <text x="550" y="225" text-anchor="middle" font-size="10" font-weight="bold" fill="#1565c0">H₃: Morning dew</text>
      <text x="550" y="242" text-anchor="middle" font-size="9" fill="#1565c0">Rule: cold night → dew</text>

      <!-- Ranking arrows -->
      <path d="M150 255 L150 280" stroke="#4caf50" stroke-width="2" marker-end="url(#abdArrowGreen)"/>
      <path d="M350 255 L350 280" stroke="#4caf50" stroke-width="2" marker-end="url(#abdArrowGreen)"/>
      <path d="M550 255 L550 280" stroke="#4caf50" stroke-width="2" marker-end="url(#abdArrowGreen)"/>

      <!-- Scores -->
      <rect x="100" y="285" width="100" height="25" rx="4" fill="#4caf50"/>
      <text x="150" y="302" text-anchor="middle" font-size="11" fill="white" font-weight="bold">P=0.85</text>

      <rect x="300" y="285" width="100" height="25" rx="4" fill="#8bc34a"/>
      <text x="350" y="302" text-anchor="middle" font-size="11" fill="white" font-weight="bold">P=0.60</text>

      <rect x="500" y="285" width="100" height="25" rx="4" fill="#cddc39"/>
      <text x="550" y="302" text-anchor="middle" font-size="11" fill="#333" font-weight="bold">P=0.40</text>

      <defs>
        <marker id="abdArrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
          <polygon points="0 0, 10 3.5, 0 7" fill="#546e7a"/>
        </marker>
        <marker id="abdArrowGreen" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
          <polygon points="0 0, 10 3.5, 0 7" fill="#4caf50"/>
        </marker>
      </defs>
    </svg>
  </div>

  <h2>3. Algorithm: Abductive Inference</h2>

  <div class="algorithm-box">
    <strong>Algorithm: abduce(observation, kb)</strong>
    <ol>
      <li><strong>Initialize:</strong> hypotheses = []</li>
      <li><strong>Find explanatory rules:</strong>
        <ul>
          <li>For each rule R: (P → C) in KB</li>
          <li>θ = unify(observation, C)</li>
          <li>If θ ≠ FAIL: Add (P·θ, R) to candidates</li>
        </ul>
      </li>
      <li><strong>Check consistency:</strong>
        <ul>
          <li>For each candidate H:</li>
          <li>If prove(Not(H), KB) fails (H is not contradicted)</li>
          <li>Add H to hypotheses</li>
        </ul>
      </li>
      <li><strong>Score hypotheses:</strong>
        <ul>
          <li>Prior probability P(H)</li>
          <li>Explanatory coverage (how much of O does H explain?)</li>
          <li>Simplicity (prefer fewer assumptions)</li>
        </ul>
      </li>
      <li><strong>Rank:</strong> Sort by score descending</li>
      <li><strong>Return:</strong> Ranked hypotheses with scores</li>
    </ol>
  </div>

  <h2>4. Hypothesis Scoring</h2>

  <div class="math-box">
    <p><strong>Bayesian Formulation:</strong></p>
    <div class="equation">
      P(H|O) = P(O|H) × P(H) / P(O)
    </div>
    <p>The probability of hypothesis H given observation O depends on:</p>
    <ul>
      <li><strong>P(O|H):</strong> How well does H explain O? (likelihood)</li>
      <li><strong>P(H):</strong> How plausible is H a priori? (prior)</li>
      <li><strong>P(O):</strong> How surprising is O? (evidence)</li>
    </ul>
  </div>

  <table>
    <tr>
      <th>Scoring Factor</th>
      <th>Description</th>
      <th>Weight</th>
    </tr>
    <tr>
      <td><strong>Rule confidence</strong></td>
      <td>Strength of the explanatory rule</td>
      <td>0.35</td>
    </tr>
    <tr>
      <td><strong>Prior probability</strong></td>
      <td>Base rate of hypothesis being true</td>
      <td>0.25</td>
    </tr>
    <tr>
      <td><strong>Explanatory coverage</strong></td>
      <td>Fraction of observations explained</td>
      <td>0.25</td>
    </tr>
    <tr>
      <td><strong>Simplicity</strong></td>
      <td>Fewer assumptions preferred (Occam)</td>
      <td>0.15</td>
    </tr>
  </table>

  <h2>5. Types of Abduction</h2>

  <div class="example-box">
    <strong>Simple Abduction:</strong> Find a single hypothesis explaining one observation.
    <pre><code>Observation: isA Socrates Mortal
Rule: @r1 Implies (isA ?x Human) (isA ?x Mortal)
Hypothesis: isA Socrates Human</code></pre>
  </div>

  <div class="example-box">
    <strong>Composite Abduction:</strong> Find a hypothesis explaining multiple observations.
    <pre><code>Observations:
  - hasSymptom Patient123 Fever
  - hasSymptom Patient123 Cough
  - hasSymptom Patient123 Fatigue

Hypothesis: hasDiagnosis Patient123 Influenza
(Explains all three symptoms via known rules)</code></pre>
  </div>

  <div class="example-box">
    <strong>Discriminating Abduction:</strong> Find hypothesis that explains O₁ but not O₂.
    <pre><code>Observations:
  - The grass is wet
  - The sidewalk is dry

H₁ (rain) would wet both → Rejected
H₂ (sprinklers) only wet grass → Accepted</code></pre>
  </div>

  <h2>6. Abduction in Practice</h2>

  <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; margin: 20px 0;">
    <svg viewBox="0 0 700 200" style="width: 100%; max-width: 800px; display: block; margin: 0 auto;">
      <!-- Title -->
      <text x="350" y="20" text-anchor="middle" font-size="14" font-weight="bold" fill="#333">Application Domains</text>

      <!-- Medical Diagnosis -->
      <rect x="30" y="45" width="150" height="130" rx="8" fill="#e3f2fd" stroke="#1976d2" stroke-width="2"/>
      <text x="105" y="70" text-anchor="middle" font-size="12" font-weight="bold" fill="#1565c0">Medical Diagnosis</text>
      <text x="105" y="90" text-anchor="middle" font-size="9" fill="#1565c0">Symptoms → Disease</text>
      <line x1="50" y1="100" x2="160" y2="100" stroke="#1976d2" stroke-width="1"/>
      <text x="55" y="118" font-size="9" fill="#333">• Fever, Cough</text>
      <text x="55" y="133" font-size="9" fill="#333">• Fatigue</text>
      <text x="55" y="148" font-size="9" fill="#333">→ Flu? COVID?</text>
      <text x="55" y="163" font-size="9" fill="#333">   Pneumonia?</text>

      <!-- Fault Diagnosis -->
      <rect x="200" y="45" width="150" height="130" rx="8" fill="#f3e5f5" stroke="#9c27b0" stroke-width="2"/>
      <text x="275" y="70" text-anchor="middle" font-size="12" font-weight="bold" fill="#7b1fa2">Fault Diagnosis</text>
      <text x="275" y="90" text-anchor="middle" font-size="9" fill="#7b1fa2">Symptoms → Cause</text>
      <line x1="220" y1="100" x2="330" y2="100" stroke="#9c27b0" stroke-width="1"/>
      <text x="225" y="118" font-size="9" fill="#333">• Car won't start</text>
      <text x="225" y="133" font-size="9" fill="#333">• No lights</text>
      <text x="225" y="148" font-size="9" fill="#333">→ Dead battery?</text>
      <text x="225" y="163" font-size="9" fill="#333">   Bad alternator?</text>

      <!-- Scientific Discovery -->
      <rect x="370" y="45" width="150" height="130" rx="8" fill="#e8f5e9" stroke="#4caf50" stroke-width="2"/>
      <text x="445" y="70" text-anchor="middle" font-size="12" font-weight="bold" fill="#2e7d32">Scientific Discovery</text>
      <text x="445" y="90" text-anchor="middle" font-size="9" fill="#2e7d32">Data → Theory</text>
      <line x1="390" y1="100" x2="500" y2="100" stroke="#4caf50" stroke-width="1"/>
      <text x="395" y="118" font-size="9" fill="#333">• Planetary motion</text>
      <text x="395" y="133" font-size="9" fill="#333">• Orbital periods</text>
      <text x="395" y="148" font-size="9" fill="#333">→ Gravity?</text>
      <text x="395" y="163" font-size="9" fill="#333">   Kepler's laws?</text>

      <!-- Story Understanding -->
      <rect x="540" y="45" width="150" height="130" rx="8" fill="#fff3e0" stroke="#ef6c00" stroke-width="2"/>
      <text x="615" y="70" text-anchor="middle" font-size="12" font-weight="bold" fill="#e65100">Story Understanding</text>
      <text x="615" y="90" text-anchor="middle" font-size="9" fill="#e65100">Event → Reason</text>
      <line x1="560" y1="100" x2="670" y2="100" stroke="#ef6c00" stroke-width="1"/>
      <text x="565" y="118" font-size="9" fill="#333">• John went to store</text>
      <text x="565" y="133" font-size="9" fill="#333">• Bought milk</text>
      <text x="565" y="148" font-size="9" fill="#333">→ Needed milk?</text>
      <text x="565" y="163" font-size="9" fill="#333">   Out of milk?</text>
    </svg>
  </div>

  <h2>7. Handling Multiple Observations</h2>

  <div class="algorithm-box">
    <strong>Multi-Observation Abduction:</strong>
    <pre><code>function abduceMultiple(observations, kb):
  // Find hypotheses that explain ALL observations
  candidateSets = []

  for each H that could explain observations[0]:
    remaining = observations.slice(1)
    if all remaining are explained by H or derivable from kb ∪ {H}:
      candidateSets.push({H})
    else:
      // Try combining hypotheses
      for each H2 that could explain remaining[0]:
        combined = {H, H2}
        if all observations explained by kb ∪ combined:
          if consistent(combined, kb):
            candidateSets.push(combined)

  // Rank by parsimony: prefer smaller sets
  return sortBySize(candidateSets)</code></pre>
  </div>

  <h2>8. Example: Diagnostic Reasoning</h2>

  <div class="example-box">
    <strong>Knowledge Base:</strong>
    <pre><code>@r1 Implies (hasDiagnosis ?p Flu) (hasSymptom ?p Fever)
@r2 Implies (hasDiagnosis ?p Flu) (hasSymptom ?p Cough)
@r3 Implies (hasDiagnosis ?p Flu) (hasSymptom ?p Fatigue)
@r4 Implies (hasDiagnosis ?p Cold) (hasSymptom ?p Cough)
@r5 Implies (hasDiagnosis ?p Cold) (hasSymptom ?p Sneezing)
@r6 Implies (hasDiagnosis ?p Allergy) (hasSymptom ?p Sneezing)</code></pre>

    <strong>Observations:</strong>
    <pre><code>hasSymptom Patient1 Fever
hasSymptom Patient1 Cough
hasSymptom Patient1 Fatigue</code></pre>

    <strong>Abduction Result:</strong>
    <pre><code>Hypotheses:
1. hasDiagnosis Patient1 Flu
   - Explains: Fever ✓, Cough ✓, Fatigue ✓
   - Coverage: 100%
   - Score: 0.92

2. And (hasDiagnosis Patient1 Cold) (unknown-cause Fever)
   - Explains: Cough ✓ (partial)
   - Coverage: 33%
   - Score: 0.35</code></pre>
  </div>

  <h2>9. Confidence and Uncertainty</h2>

  <div class="math-box">
    <p><strong>Confidence Propagation:</strong></p>
    <div class="equation">
      confidence(H) = Σᵢ coverage(H, Oᵢ) × rule_strength(Rᵢ) × prior(H)
    </div>
    <p>The confidence in a hypothesis depends on how well it explains observations, the strength of the rules used, and prior plausibility.</p>
  </div>

  <table>
    <tr>
      <th>Confidence Level</th>
      <th>Interpretation</th>
      <th>Action</th>
    </tr>
    <tr>
      <td><strong>0.9 - 1.0</strong></td>
      <td>Strong explanation</td>
      <td>Accept hypothesis</td>
    </tr>
    <tr>
      <td><strong>0.7 - 0.9</strong></td>
      <td>Likely explanation</td>
      <td>Consider accepting</td>
    </tr>
    <tr>
      <td><strong>0.5 - 0.7</strong></td>
      <td>Possible explanation</td>
      <td>Seek more evidence</td>
    </tr>
    <tr>
      <td><strong>< 0.5</strong></td>
      <td>Weak explanation</td>
      <td>Explore alternatives</td>
    </tr>
  </table>

  <h2>10. API Reference</h2>

  <pre><code>import { AbductionEngine } from 'agisystem2/reasoning';

const engine = new AbductionEngine(session);

// Simple abduction
const hypotheses = await engine.abduce({
  operator: 'hasSymptom',
  args: ['Patient1', 'Fever']
});

// Multiple observations
const hypotheses = await engine.abduceMultiple([
  { operator: 'hasSymptom', args: ['Patient1', 'Fever'] },
  { operator: 'hasSymptom', args: ['Patient1', 'Cough'] }
]);

// With options
const hypotheses = await engine.abduce(observation, {
  maxHypotheses: 5,        // Limit results
  minConfidence: 0.5,      // Filter weak hypotheses
  requireCoverage: 0.8,    // Minimum explanation coverage
  checkConsistency: true   // Verify consistency with KB
});</code></pre>

  <h2>11. Related Documentation</h2>

  <ul>
    <li><a href="proof-engine.html">Proof Engine</a> – Deductive reasoning</li>
    <li><a href="query-engine.html">Query Engine</a> – Finding bindings</li>
    <li><a href="induction.html">Induction Engine</a> – Learning rules</li>
    <li><a href="symbolic.html">Symbolic Reasoning</a> – Complete symbolic engine</li>
  </ul>

  <div class="footer-nav">
    <p><a href="index.html">&larr; Back to Reasoning Engines</a></p>
  </div>
  </div>
</body>
</html>
