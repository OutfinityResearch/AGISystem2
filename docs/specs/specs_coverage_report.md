# Specs Coverage Report

_Last updated: generated by Codex agent_

## High-Level Takeaways
- `docs/specs/src` covers 34 modules. 29 match the current JS implementation, 5 are stale (missing new exports or strategy-aware logic), and whole subsystems like `src/nlp`, `src/output`, `src/reasoning/holographic/*`, `src/reasoning/csp/*`, and `src/utils` have no dedicated spec docs yet.
- `docs/specs/DS` documents 29 design chapters. The foundational ones (DS07a–DS07h, DS09, DS11–DS18) map to live code, but DS08 (Trustworthy AI patterns) and DS10 (Code Plan) lack actual theories/config files. DS03 Architecture & Memory and DS06 Advanced Reasoning are only partially realized in code.
- Config coverage is now complete via the new `docs/specs/config/*.md` files; runtime tests such as `tests/unit/runtime/core-theories.test.mjs:12-110` ensure every `.sys2` file loads.
- EvalSuite implements DS14’s “one suite = one Session” model in `evalSuite/lib/runner.mjs:24-200`, but timeouts and NL-to-DSL validation differ slightly from the spec (uses soft timeouts and allows transformer output drift).

## docs/specs/src ↔ src alignment

### Core modules
| Spec doc | Implementation | Tests exercising it | Notes |
|----------|----------------|----------------------|-------|
| `core/vector.mjs.md` | `src/core/vector.mjs:1-23` re-exports HDC facade exactly as spec describes | Covered whenever `Session` binds facts | Up to date. |
| `core/operations.mjs.md` | `src/core/operations.mjs:12-48` only re-exports bind/bundle/similarity plus geometry helpers; spec still lists clone/equals/createRandom APIs that no longer exist here | `tests/unit/hdc/facade-isVector.test.mjs` indirectly uses exports | **Stale spec** – document should call out `getDefaultGeometry`/`setDefaultGeometry` and note the missing helpers now live in the facade. |
| `core/position.mjs.md` | `src/core/position.mjs:1-87` now strategy-aware, adds `extractAtPosition` and `clearPositionCache` and uses `createFromName` instead of `asciiStamp` | `tests/unit/core/position.test.mjs` | Spec needs to reflect strategy-aware cache + new helper. |
| `core/constants.mjs.md` | `src/core/constants.mjs:1-127` defines dynamic threshold maps per strategy and reasoning priority helpers | `tests/unit/hdc/facade-isVector.test.mjs` + reasoning tests | Spec should mention new exports (`REASONING_PRIORITY`, `getThresholds`, `getHolographicThresholds`). |
| `core/index.mjs.md` | `src/core/index.mjs:1-12` matches spec |

### Top-level entry point
- `docs/specs/src/index.mjs.md` omits the recently added `extractAtPosition` export (`src/index.mjs:8-57`) and does not mention decoding/test-lib exports; update doc to keep the public API list in sync.

### Parser modules
- Specs for lexer/parser/AST (`docs/specs/src/parser/*.md`) align with `src/parser/*.mjs`; parser tests in `tests/unit/parser/*.mjs` exercise the behaviors, satisfying DS02.

### Runtime modules
| Spec doc | Implementation | Notes |
|----------|----------------|-------|
| `runtime/session.mjs.md` | Implementation in `src/runtime/session.mjs:1-738` now includes holographic priority routing, component KB (`component-kb.mjs`), response translators, EvalSuite telemetry, and CSP solve handling not mentioned anywhere in the spec. Public API still roughly matches but method signatures/options differ (e.g., `Session` constructor accepts `reasoningPriority`). |
| `runtime/executor.mjs.md`, `runtime/vocabulary.mjs.md`, `runtime/scope.mjs.md`, `runtime/index.mjs.md` | All map directly to code; executor tests in `tests/unit/runtime/executor.test.mjs` and scope/vocabulary tests keep them covered. |

### Reasoning modules
- Specs exist for `query`, `prove`, `conditions`, `kb-matching`, `transitive`, and `index`. Implementation exceeds docs:
  - `src/reasoning/index.mjs:1-122` now exports abduction/induction engines and holographic priority helpers, whereas the spec only lists Query/Proof re-exports.
  - There are no specs for `abduction.mjs`, `induction.mjs`, `defaults.mjs`, `component-kb.mjs`, `find-all.mjs`, `query-meta-ops.mjs`, or any `holographic/*` or `csp/*` module, even though these implement DS06/DS16/DS17.
  - Tests exist (`tests/unit/reasoning/*.mjs`, `tests/unit/reasoning/csp-hdc.test.mjs`, `tests/integration/deep-reasoning.test.mjs`) but cannot trace back to missing specs.

### HDC modules
- Docs cover `hdc/facade`, `hdc/contract`, and `strategies/dense-binary`. Missing specs: `sparse-polynomial.mjs`, `metric-affine.mjs`, and both threshold files. Implementations (`src/hdc/strategies/metric-affine.mjs:1-60`, `src/hdc/strategies/sparse-polynomial.mjs:1-120`) plus DS15/DS18 describe the theory, but there is no module-level spec tying them together.
- Tests only cover facade detection (`tests/unit/hdc/facade-isVector.test.mjs:27-44`) and util hashing; no direct vector arithmetic tests exist for metric-affine or sparse polynomial strategies.

### Decoding & Output
- `docs/specs/src/decoding/*.md` map cleanly onto `src/decoding/*.mjs` with coverage via `tests/unit/decoding/*.mjs`.
- There are **no specs** for `src/output/response-translator.mjs`, `src/output/result-formatter.mjs`, or `src/output/text-generator.mjs` even though these modules implement NL generation (`src/output/response-translator.mjs:1-140`) required by DS11/DS14.

### Test library & util
- Specs for `src/test-lib/*` and `src/util/*` match implementation, and integration tests (`tests/integration/e2e-pipeline.test.mjs`, `tests/unit/util/*.mjs`) exercise them.

### Modules lacking any spec coverage
- `src/nlp/*.mjs` (tokenizer, transformer, normalizer) correspond to DS13, but there are no `docs/specs/src/nlp/*.md` plans. Tests exist: `tests/unit/nlp/*.mjs`.
- `src/output/*.mjs` and `src/utils/debug.js` lack specs.
- `src/reasoning` submodules beyond the six listed earlier (defaults, property-inheritance, prove-search-trace, holographic engines, CSP, component KB, etc.) are currently undocumented.

## docs/specs/DS ↔ implementation
| DS Chapter | Implementation Reference | Status |
|------------|-------------------------|--------|
| DS00 Vision | Documentation only | Conceptual – no code needed. |
| DS01 Theory | Reflected in overall architecture (`src/runtime/session.mjs:1-120`) | Conceptual baseline satisfied. |
| DS02 DSL Syntax | Parser/lexer modules + `tests/unit/parser/*.mjs` | Implemented & tested. |
| DS03 Architecture | `src/runtime/session.mjs`, `src/runtime/executor.mjs`, `src/runtime/scope.mjs` | Partially implemented; doc references a TheoryRegistry that still does not exist. |
| DS03 Memory Model | `Session` still uses `kbFacts` array (no vectorized episodic store) | Partial. |
| DS05 Basic Reasoning | `src/reasoning/query.mjs`, `src/reasoning/prove.mjs` + unit tests | Implemented. |
| DS06 Advanced Reasoning | Abduction/Induction/WhatIf modules exist with tests (`tests/unit/reasoning/abduction.test.mjs`, `induction.test.mjs`, `whatif.test.mjs`) | Implemented but missing specs. |
| DS07a–DS07h Core Theory | `config/Core/*.sys2` files + new markdown specs + runtime loading (`tests/unit/runtime/core-theories.test.mjs:12-110`) | Fully implemented. |
| DS08 Trustworthy AI Patterns | Only documented in `DS08-ThurstworthyAI-Patterns.md:43-150`; no corresponding `config` or `src` files contain `AgentPlanning`, `HasFile`, etc. | **Not implemented.** |
| DS09 Core HDC Implementation | `src/hdc/facade.mjs`, strategies, plus tests | Implemented though module specs are missing for new strategies. |
| DS10 Code Plan | No direct code artifact; plan partially reflected in repo structure | Documentation-only. |
| DS11 Decoding & Phrasing | `src/decoding/*.mjs` + tests `tests/unit/decoding/*.mjs` | Implemented. |
| DS12 Test Library | `src/test-lib/*.mjs` and usage in `tests/integration/*.mjs` | Implemented. |
| DS13 Basic NLP | `src/nlp/*.mjs` + tests `tests/unit/nlp/*.mjs` | Implemented but lacks module specs. |
| DS14 EvalSuite | `evalSuite/lib/runner.mjs:24-200` enforces one Session per suite and dual-input flows | Implemented, though spec’s strict NL-vs-DSL comparison is relaxed in code. |
| DS15 Sparse Polynomial HDC | `src/hdc/strategies/sparse-polynomial.mjs` | Implemented but undocumented at module level. |
| DS16 CSP Solver | `src/reasoning/csp/*.mjs` + `tests/unit/reasoning/csp-hdc.test.mjs` | Implemented; add module specs. |
| DS17 Holographic Priority Mode | `src/reasoning/index.mjs:1-122`, `src/reasoning/holographic/*.mjs`, env var `REASONING_PRIORITY` in `src/core/constants.mjs:70-110` | Implemented but un-documented per module. |
| DS17 Meta-Query Operators | `src/reasoning/query-meta-ops.mjs` and `query.mjs:29-330` | Implemented without dedicated spec. |
| DS18 Metric-Affine HDC | `src/hdc/strategies/metric-affine.mjs:1-60` | Implemented; needs spec + tests beyond type detection.

## Config mapping
- Each `config/Core/*.sys2` file now has a spec under `docs/specs/config/`. Loading coverage remains in `tests/unit/runtime/core-theories.test.mjs:12-110` and EvalSuite’s loader (`evalSuite/lib/runner.mjs:34-65`).
- Gap: `config/Core/index.sys2:1-4` only loads types, positions, and roles, whereas DS07 expects it to orchestrate all subtheories. Runners compensate by manually loading every `.sys2` file, but the spec should clarify this discrepancy.

## Actionable Follow-ups
1. Refresh stale module specs (`src/index`, `src/core/operations`, `src/core/position`, `src/core/constants`, `src/runtime/session`, `src/reasoning/index`).
2. Author new specs for the uncovered modules (NLP stack, output modules, reasoning holographic/CSP components, additional HDC strategies, ComponentKB, defaults engine, etc.).
3. Either implement DS08’s theories in `config/` + tests or mark the chapter as exploratory to avoid confusion.
4. Decide whether `config/Core/index.sys2` should load every theory or document why it intentionally stays minimal.
5. Expand automated tests for Metric-Affine and Sparse Polynomial strategies beyond `isVector` detection to match DS15/DS18 performance expectations.
