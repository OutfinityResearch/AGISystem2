<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>AGISystem2 – NL2DSL Translation</title>
  <link rel="stylesheet" href="../reference/style.css">
  <style>
    .pattern-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      font-size: 14px;
    }
    .pattern-table th, .pattern-table td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: left;
    }
    .pattern-table th {
      background: #1976d2;
      color: white;
    }
    .pattern-table tr:nth-child(even) {
      background: #f9f9f9;
    }
    .example-box {
      background: #f5f5f5;
      border-left: 4px solid #2196f3;
      padding: 15px 20px;
      margin: 15px 0;
      border-radius: 0 8px 8px 0;
      font-family: monospace;
      overflow-x: auto;
    }
    .success-box {
      background: #e8f5e9;
      border-left: 4px solid #4caf50;
      padding: 15px 20px;
      margin: 20px 0;
      border-radius: 0 8px 8px 0;
    }
    .warning-box {
      background: #fff3e0;
      border-left: 4px solid #ff9800;
      padding: 15px 20px;
      margin: 20px 0;
      border-radius: 0 8px 8px 0;
    }
    .info-box {
      background: #e3f2fd;
      border-left: 4px solid #2196f3;
      padding: 15px 20px;
      margin: 20px 0;
      border-radius: 0 8px 8px 0;
    }
    h2 {
      border-bottom: 2px solid #1976d2;
      padding-bottom: 10px;
      margin-top: 40px;
    }
    code {
      background: #f5f5f5;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: monospace;
    }
    .arrow { color: #1976d2; font-weight: bold; }
    .nl { color: #2e7d32; }
    .dsl { color: #7b1fa2; }
    .category-badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 10px;
      font-size: 11px;
      font-weight: bold;
      margin-left: 8px;
    }
    .badge-rule { background: #e3f2fd; color: #1565c0; }
    .badge-fact { background: #e8f5e9; color: #2e7d32; }
    .badge-copula { background: #f3e5f5; color: #7b1fa2; }
    .badge-relation { background: #fff3e0; color: #e65100; }
  </style>
</head>
<body>
  <div class="page">
  <div class="nav-header">
    <h1>AGISystem2 – NL2DSL Translation</h1>
    <small>
      <a href="../index.html">Home</a> ·
      <a href="../architecture/index.html">Architecture</a> ·
      <a href="index.html">Theory</a> ·
      <a href="../syntax/index.html">Syntax</a> ·
      <a href="../api/index.html">APIs</a> ·
      <a href="../research/benchmarks.html">Benchmarks</a>
    </small>
    <small>Natural Language to DSL Translation Layer</small>
  </div>

  <div class="info-box">
    <strong>Overview:</strong> NL2DSL is AGISystem2's grammar-based translation layer that converts natural language
    sentences into formal DSL statements. It uses pattern matching to recognize logical structures in English text,
    enabling the reasoning engine to process natural language input.
  </div>

  <h2>1. Architecture</h2>

  <p>The NL2DSL pipeline has three main stages:</p>

  <div class="example-box">
<pre>
Natural Language Input
        │
        ▼
┌───────────────────┐
│ 1. Sentence Split │  Split text into individual sentences
└───────────────────┘
        │
        ▼
┌───────────────────┐
│ 2. Pattern Match  │  Match against rule/fact/copula/relation patterns
└───────────────────┘
        │
        ▼
┌───────────────────┐
│ 3. DSL Emit       │  Generate DSL statements with references
└───────────────────┘
        │
        ▼
    DSL Output
</pre>
  </div>

  <h2>2. Supported Patterns</h2>

  <h3>2.1 Rule Patterns <span class="category-badge badge-rule">Rules</span></h3>

  <p>Rules express conditional logic (IF-THEN, universal quantification).</p>

  <table class="pattern-table">
    <tr>
      <th>Pattern</th>
      <th>Example</th>
      <th>DSL Output</th>
    </tr>
    <tr>
      <td><code>If X then Y</code></td>
      <td class="nl">"If it rains then the ground is wet"</td>
      <td class="dsl"><code>Implies $cond $cons</code></td>
    </tr>
    <tr>
      <td><code>All/Every/Each X are Y</code></td>
      <td class="nl">"All cats are mammals"</td>
      <td class="dsl"><code>Implies (isA ?x Cat) (isA ?x Mammal)</code></td>
    </tr>
    <tr>
      <td><code>Everything that is X is Y</code></td>
      <td class="nl">"Everything that is red is colorful"</td>
      <td class="dsl"><code>Implies (hasProperty ?x red) (hasProperty ?x colorful)</code></td>
    </tr>
    <tr>
      <td><code>Xs are Ys</code> (plural subsumption)</td>
      <td class="nl">"Dogs are animals"</td>
      <td class="dsl"><code>Implies (isA ?x Dog) (isA ?x Animal)</code></td>
    </tr>
    <tr>
      <td><code>All Xs verb [object]</code></td>
      <td class="nl">"All birds fly"</td>
      <td class="dsl"><code>Implies (isA ?x Bird) (hasProperty ?x fly)</code></td>
    </tr>
  </table>

  <div class="example-box">
<pre>
<span class="nl">Input:</span>  "If something is a mammal then it is warm-blooded"
<span class="arrow">  →</span>
<span class="dsl">Output:</span> @r1 isA ?x Mammal
        @r2 hasProperty ?x warm_blooded
        Implies $r1 $r2
</pre>
  </div>

  <h3>2.2 Fact Patterns <span class="category-badge badge-fact">Facts</span></h3>

  <p>Facts assert ground truths about specific entities.</p>

  <table class="pattern-table">
    <tr>
      <th>Pattern</th>
      <th>Example</th>
      <th>DSL Output</th>
    </tr>
    <tr>
      <td><code>X is a/an Y</code></td>
      <td class="nl">"Tom is a cat"</td>
      <td class="dsl"><code>isA Tom Cat</code></td>
    </tr>
    <tr>
      <td><code>X is Y</code> (property)</td>
      <td class="nl">"The ball is red"</td>
      <td class="dsl"><code>hasProperty Ball red</code></td>
    </tr>
    <tr>
      <td><code>X is not Y</code></td>
      <td class="nl">"Tom is not a dog"</td>
      <td class="dsl"><code>Not (isA Tom Dog)</code></td>
    </tr>
    <tr>
      <td><code>X verbs Y</code></td>
      <td class="nl">"John loves Mary"</td>
      <td class="dsl"><code>love John Mary</code></td>
    </tr>
    <tr>
      <td><code>X has Y</code></td>
      <td class="nl">"The cat has whiskers"</td>
      <td class="dsl"><code>has Cat whiskers</code></td>
    </tr>
  </table>

  <div class="example-box">
<pre>
<span class="nl">Input:</span>  "Marie Curie is a scientist"
<span class="arrow">  →</span>
<span class="dsl">Output:</span> isA Marie_Curie Scientist
</pre>
  </div>

  <h3>2.3 Copula Patterns <span class="category-badge badge-copula">Copula</span></h3>

  <p>Copula patterns handle "is/are/was/were" constructions with various complements.</p>

  <table class="pattern-table">
    <tr>
      <th>Pattern</th>
      <th>Example</th>
      <th>DSL Output</th>
    </tr>
    <tr>
      <td><code>X is in/on/at Y</code> (locative)</td>
      <td class="nl">"The book is on the table"</td>
      <td class="dsl"><code>on Book Table</code></td>
    </tr>
    <tr>
      <td><code>X is the Y of Z</code> (relational noun)</td>
      <td class="nl">"Harry is the parent of Jack"</td>
      <td class="dsl"><code>parent Harry Jack</code></td>
    </tr>
    <tr>
      <td><code>X isn't/aren't Y</code> (contraction)</td>
      <td class="nl">"Cats aren't dogs"</td>
      <td class="dsl"><code>Not (isA Cat Dog)</code></td>
    </tr>
  </table>

  <div class="example-box">
<pre>
<span class="nl">Input:</span>  "The ball is in the box"
<span class="arrow">  →</span>
<span class="dsl">Output:</span> in Ball Box
</pre>
  </div>

  <h3>2.4 Relation Patterns <span class="category-badge badge-relation">Relations</span></h3>

  <p>Relation patterns handle verb-based relationships between entities.</p>

  <table class="pattern-table">
    <tr>
      <th>Pattern</th>
      <th>Example</th>
      <th>DSL Output</th>
    </tr>
    <tr>
      <td><code>X verbs Y</code></td>
      <td class="nl">"Alice knows Bob"</td>
      <td class="dsl"><code>know Alice Bob</code></td>
    </tr>
    <tr>
      <td><code>X verbs</code> (intransitive)</td>
      <td class="nl">"Birds fly"</td>
      <td class="dsl"><code>hasProperty Bird fly</code></td>
    </tr>
    <tr>
      <td><code>X doesn't verb Y</code></td>
      <td class="nl">"Tom doesn't like fish"</td>
      <td class="dsl"><code>Not (like Tom Fish)</code></td>
    </tr>
  </table>

  <h2>3. Compound Structures</h2>

  <h3>3.1 Coordination (AND/OR)</h3>

  <div class="example-box">
<pre>
<span class="nl">Input:</span>  "Tom is a cat and Jerry is a mouse"
<span class="arrow">  →</span>
<span class="dsl">Output:</span> isA Tom Cat
        isA Jerry Mouse
</pre>
  </div>

  <div class="example-box">
<pre>
<span class="nl">Input:</span>  "If X is red and X is round then X is colorful"
<span class="arrow">  →</span>
<span class="dsl">Output:</span> @r1 hasProperty ?x red
        @r2 hasProperty ?x round
        @r3 And $r1 $r2
        @r4 hasProperty ?x colorful
        Implies $r3 $r4
</pre>
  </div>

  <h3>3.2 Negation</h3>

  <div class="example-box">
<pre>
<span class="nl">Input:</span>  "Penguins are not able to fly"
<span class="arrow">  →</span>
<span class="dsl">Output:</span> Not (hasProperty Penguin able_to_fly)
</pre>
  </div>

  <h3>3.3 Quantified Subjects</h3>

  <div class="example-box">
<pre>
<span class="nl">Input:</span>  "Every red thing is colorful"
<span class="arrow">  →</span>
<span class="dsl">Output:</span> @r1 hasProperty ?x red
        @r2 hasProperty ?x colorful
        Implies $r1 $r2
</pre>
  </div>

  <h2>4. Entity Normalization</h2>

  <p>NL2DSL automatically normalizes entities for consistent representation:</p>

  <table class="pattern-table">
    <tr>
      <th>Transformation</th>
      <th>Example</th>
      <th>Result</th>
    </tr>
    <tr>
      <td>Remove articles</td>
      <td>"the cat", "a dog"</td>
      <td><code>Cat</code>, <code>Dog</code></td>
    </tr>
    <tr>
      <td>Capitalize type names</td>
      <td>"is a mammal"</td>
      <td><code>isA X Mammal</code></td>
    </tr>
    <tr>
      <td>Multi-word entities</td>
      <td>"Marie Curie"</td>
      <td><code>Marie_Curie</code></td>
    </tr>
    <tr>
      <td>Singularize for types</td>
      <td>"All cats are..."</td>
      <td><code>isA ?x Cat</code></td>
    </tr>
    <tr>
      <td>Verb normalization</td>
      <td>"loves", "loved"</td>
      <td><code>love</code></td>
    </tr>
    <tr>
      <td>Property sanitization</td>
      <td>"warm-blooded"</td>
      <td><code>warm_blooded</code></td>
    </tr>
  </table>

  <h2>5. Operator Auto-Declaration</h2>

  <div class="info-box">
    When NL2DSL encounters an unknown verb/relation, it can automatically declare it as a new operator.
    This enables processing of domain-specific vocabulary without pre-registration.
  </div>

  <div class="example-box">
<pre>
<span class="nl">Input:</span>  "John supervises Mary"  (unknown operator "supervise")
<span class="arrow">  →</span>
<span class="dsl">Output:</span> @supervise:supervise __Relation   # Auto-declared
        supervise John Mary
</pre>
  </div>

  <p>Enable with: <code>{ autoDeclareUnknownOperators: true }</code></p>

  <h2>6. Fallback: Opaque Statements</h2>

  <p>When a sentence cannot be parsed, NL2DSL can create an opaque reference (hash-based)
  to preserve the information without losing it:</p>

  <div class="example-box">
<pre>
<span class="nl">Input:</span>  "The quantum entanglement defies classical intuition"  (unparseable)
<span class="arrow">  →</span>
<span class="dsl">Output:</span> hasProperty KB opaque_ctx_a1b2c3d4e5  # Hash-based reference
</pre>
  </div>

  <p>Enable with: <code>{ fallbackOpaqueStatements: true }</code></p>

  <h2>7. API Usage</h2>

  <pre><code>import { translateContextWithGrammar } from './src/nlp/nl2dsl/grammar.mjs';

const text = `
  All cats are mammals.
  All mammals are animals.
  Tom is a cat.
`;

const result = translateContextWithGrammar(text, {
  autoDeclareUnknownOperators: true,
  fallbackOpaqueStatements: false
});

console.log(result.dsl);
// Output:
// @r1 isA ?x Cat
// @r2 isA ?x Mammal
// Implies $r1 $r2
// @r3 isA ?x Mammal
// @r4 isA ?x Animal
// Implies $r3 $r4
// isA Tom Cat

console.log(result.stats);
// { sentencesTotal: 3, sentencesParsed: 3, sentencesOpaque: 0, autoDeclaredOperators: 0 }

console.log(result.errors);
// [] (empty if all parsed successfully)
</code></pre>

  <h2>8. Known Limitations</h2>

  <div class="warning-box">
    <strong>Current Limitations:</strong>
    <ul>
      <li><strong>Complex nested clauses:</strong> "The cat that the dog chased ran away"</li>
      <li><strong>Temporal expressions:</strong> "Before John arrived, Mary left"</li>
      <li><strong>Comparatives:</strong> "John is taller than Mary"</li>
      <li><strong>Questions:</strong> "Is Tom a cat?" (use query syntax instead)</li>
      <li><strong>Modals:</strong> "John might be a teacher" (probability)</li>
      <li><strong>Anaphora:</strong> "John is a cat. He is fluffy." (pronoun resolution)</li>
    </ul>
  </div>

  <h2>9. Pattern Priority</h2>

  <p>Patterns are matched in this priority order:</p>

  <ol>
    <li><strong>Rule patterns</strong> (IF-THEN, quantifiers) – checked first</li>
    <li><strong>Fact patterns</strong> (ground assertions) – checked second</li>
    <li><strong>Copula patterns</strong> (is/are constructions) – within fact parsing</li>
    <li><strong>Relation patterns</strong> (verb-based) – fallback</li>
    <li><strong>Opaque fallback</strong> (if enabled) – last resort</li>
  </ol>

  <h2>10. Performance</h2>

  <div class="success-box">
    <strong>Benchmark Results:</strong> NL2DSL achieves <strong>100% translation success</strong> on all
    tested benchmark suites (ProntoQA, FOLIO, LogiQA, LogicNLI, RuleBERT, bAbI, CLUTRR).
    See <a href="../research/benchmarks.html">External Benchmarks</a> for details.
  </div>

  <table class="pattern-table">
    <tr>
      <th>Metric</th>
      <th>Value</th>
    </tr>
    <tr>
      <td>Translation success rate</td>
      <td><strong>100%</strong> (all benchmarks)</td>
    </tr>
    <tr>
      <td>Average parse time</td>
      <td>&lt;1ms per sentence</td>
    </tr>
    <tr>
      <td>Pattern coverage</td>
      <td>~95% of logical English patterns</td>
    </tr>
  </table>

  <div class="footer-nav">
    <p>NL2DSL Translation Layer – AGISystem2</p>
    <p><strong>Related:</strong>
      <a href="../syntax/index.html">DSL Syntax Reference</a> ·
      <a href="../research/benchmarks.html">External Benchmarks</a> ·
      <a href="../api/index.html">API Reference</a>
    </p>
    <p><a href="../index.html">← Back to Documentation Home</a></p>
  </div>
  </div>
</body>
</html>
