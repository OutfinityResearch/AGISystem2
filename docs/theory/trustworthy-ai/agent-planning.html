<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Agent Planning - Trustworthy AI - AGISystem2</title>
  <link rel="stylesheet" href="../../reference/style.css">
</head>
<body>
  <div class="page">
  <div class="nav-header">
    <h1>AI Agent Planning and Tool Orchestration <span class="badge badge-warning">Research</span></h1>
    <small>
      <a href="../../index.html">Home</a> &middot;
      <a href="../index.html">Theory</a> &middot;
      <a href="index.html">Trustworthy AI</a> &middot;
      <a href="agent-planning.html">Agent Planning</a>
    </small>
    <small>Research pattern for verified plans</small>
  </div>

  <div class="section-intro">
    <p>AI agents need to orchestrate tools reliably. Current LLM-based planning generates plausible-looking but often invalid plans. AGISystem2 can model <strong>formal tool semantics</strong>; plan verification is a research pattern that requires external planner/runtime integration.</p>
  </div>

  <div class="alert alert-warning" style="background: #fffde7; border-left: 4px solid #fbc02d; padding: 12px 15px; margin: 12px 0; border-radius: 0 8px 8px 0;">
    <strong>Status:</strong> Research pattern (DS28). Examples are illustrative; plan generation/monitoring is not shipped in the runtime.
  </div>

  <h2>The Problem</h2>

  <p>AI agents must:</p>
  <ul>
    <li><strong>Understand tool capabilities</strong>&mdash;preconditions, effects, costs</li>
    <li><strong>Generate valid multi-step plans</strong>&mdash;each step's preconditions met by prior effects</li>
    <li><strong>Verify plans before execution</strong>&mdash;catch errors before they cause damage</li>
    <li><strong>Explain failures</strong>&mdash;not just "failed" but "why and what would fix it"</li>
    <li><strong>Replan when needed</strong>&mdash;adapt to unexpected results</li>
  </ul>

  <div class="alert alert-warning">
    <strong>Why LLM Planning Fails:</strong> LLMs generate plans based on linguistic patterns, not logical validity. A plan that "sounds right" may have impossible step sequences, missing preconditions, or circular dependencies. The failure only becomes apparent at execution time.
  </div>

  <h2>The Solution: Formal Tool Semantics</h2>

  <p>Each tool is defined with explicit preconditions and effects:</p>

  <pre><code># Tool definition structure:
# - Preconditions: What must be true before the tool can run
# - Effects: What becomes true after the tool runs
# - Cost: Resource consumption (for optimization)

@ReadFile defineTool ReadFile
    (and (has Agent HasFile ?path)
         (has Agent HasAccess ?path))       # Preconditions
    (has Agent HasData (contentOf ?path))   # Effects
    (cost Low)

@QueryDatabase defineTool QueryDatabase
    (and (has Agent Connected ?database)
         (has Agent Authenticated ?database))
    (has Agent HasData (queryResult ?query))
    (cost Medium)

@SendEmail defineTool SendEmail
    (and (has Agent Connected EmailServer)
         (has Agent Authenticated EmailServer)
         (has Agent HasData ?content))
    (has Agent Completed (sent ?content ?recipient))
    (cost Low)</code></pre>

  <h2>Plan Generation via Backward Chaining</h2>

  <p>A planner can generate plans by working backward from the goal:</p>

  <pre><code>Goal: has(Agent, Completed, sent(Q3Report, TeamMailingList))

Current State:
  - has(Agent, HasCredentials, EmailServer)
  - has(Agent, HasCredentials, SalesDB)
  - has(Agent, HasFile, ReportTemplate)

Backward chaining:

&larr; Goal requires: SendEmail tool
   Preconditions: Connected(Email) &and; Auth(Email) &and; HasData(Q3Report)

   &larr; Connected + Auth requires: Login to EmailServer
      Preconditions: HasCredentials(EmailServer) &check; (in state)

   &larr; HasData requires: Generate Q3Report
      &larr; QueryDatabase for sales data
         Preconditions: Connected(SalesDB) &and; Auth(SalesDB)
         &larr; Login to SalesDB
            Preconditions: HasCredentials(SalesDB) &check; (in state)

Generated Plan:
  Step 1: Login(SalesDB)           Pre: HasCredentials(SalesDB) &check;
  Step 2: QueryDatabase(SalesQ3)   Pre: Connected &and; Auth &check;
  Step 3: Login(EmailServer)       Pre: HasCredentials(EmailServer) &check;
  Step 4: SendEmail(Report, Team)  Pre: Connected &and; Auth &and; HasData &check;

Plan Status: VALID &check;</code></pre>

  <h2>Plan Validation</h2>

  <p>In a production integration, plans can be validated against tool semantics:</p>

  <pre><code>// Proposed plan (invalid - missing Login steps)
const invalidPlan = [QueryDatabase, SendEmail];

// Validation output:
Step 1: QueryDatabase
  &cross; Precondition FAILED: Connected(SalesDB) - not in current state
  &cross; Precondition FAILED: Authenticated(SalesDB) - not in current state

Step 2: SendEmail
  &cross; Precondition FAILED: Connected(EmailServer) - not in current state
  &cross; Precondition FAILED: HasData(Q3Report) - Step 1 failed

Plan Status: INVALID
Missing steps: Login(SalesDB), Login(EmailServer)</code></pre>

  <h2>Runtime Monitoring</h2>

  <p>During execution, a host system can monitor preconditions and trigger replanning when needed:</p>

  <pre><code>for (const step of plan.steps) {
    // Check preconditions still valid
    const preCheck = session.prove(`
        @pre satisfies CurrentState ${step.preconditions}
    `);

    if (!preCheck.valid) {
        console.log(`Step ${step.tool} blocked: ${preCheck.missing}`);
        // Trigger replanning from current state
        const newPlan = session.prove(`
            @replan achieves Agent $goal from CurrentState
        `);
        continue;
    }

    // Execute and update state
    const result = await executeToolCall(step.tool, step.args);
    session.learn(`@_ updateState CurrentState ${step.postconditions}`);
}</code></pre>

  <h2>Potential Benefits (When Implemented)</h2>

  <div class="section-grid">
    <div class="section-card">
      <h3>Safety</h3>
      <p>Invalid plans can be caught before execution when integrated.</p>
    </div>

    <div class="section-card">
      <h3>Efficiency</h3>
      <p>Cost-aware plans can reduce wasted API calls or redundant operations.</p>
    </div>

    <div class="section-card">
      <h3>Explainability</h3>
      <p>Plans can carry justifications so users can understand each step.</p>
    </div>

    <div class="section-card">
      <h3>Debuggability</h3>
      <p>When plans fail, diagnostics can show which precondition wasn't met and what would fix it.</p>
    </div>
  </div>

  <h2>Integration with LLMs</h2>

  <p>AGISystem2 complements LLMs rather than replacing them:</p>

  <table>
    <tr>
      <th>Task</th>
      <th>LLM Role</th>
      <th>AGISystem2 Role</th>
    </tr>
    <tr>
      <td>Intent understanding</td>
      <td>"Send Q3 report to team" &rarr; structured goal</td>
      <td>Validate goal is achievable</td>
    </tr>
    <tr>
      <td>Plan generation</td>
      <td>Propose candidate plans</td>
      <td>Verify plan validity, optimize</td>
    </tr>
    <tr>
      <td>Error handling</td>
      <td>Generate user-friendly messages</td>
      <td>Diagnose exact failure cause</td>
    </tr>
    <tr>
      <td>Replanning</td>
      <td>Suggest alternatives</td>
      <td>Verify alternatives are valid</td>
    </tr>
  </table>

  <h2>Research Directions</h2>

  <ul>
    <li><strong>Hierarchical planning:</strong> Decompose complex goals into subgoals with their own tool requirements</li>
    <li><strong>Probabilistic effects:</strong> Handle tools with uncertain outcomes (network may fail, API may timeout)</li>
    <li><strong>Resource constraints:</strong> Plan under budget limits, rate limits, time constraints</li>
    <li><strong>Multi-agent coordination:</strong> Multiple agents collaborating with shared resources</li>
    <li><strong>Learning tool models:</strong> Automatically discover tool preconditions and effects from execution traces</li>
  </ul>

  <h2>Related Documentation</h2>

	  <ul>
	    <li><a href="index.html">Trustworthy AI Overview</a></li>
	    <li><a href="../../specsLoader.html?spec=DS/DS28-Agent-Planning-and-Tool-Orchestration-RESEARCH.md">DS28 Specification (Agent Planning &amp; Tool Orchestration)</a></li>
	    <li><a href="../../specsLoader.html?spec=DS/DS05-Basic-Reasoning-Engine.md">Reasoning Engine Specification</a></li>
	  </ul>

  <div class="footer-nav">
    <p>
      <a href="index.html">&larr; Trustworthy AI</a> |
      <a href="compliance.html">Compliance & Verification &rarr;</a>
    </p>
  </div>
  </div>
</body>
</html>
