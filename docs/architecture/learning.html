<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Learning Flows</title>
  <link rel="stylesheet" href="../reference/style.css">
</head>
<body>
  <div class="page">
  <div class="nav-header">
    <h1>AGISystem2 – Learning Flows</h1>
    <small>
      <a href="../index.html">Home</a> ·
      <a href="../guides/conceptual_spaces.html">Theory</a> ·
      <a href="index.html">Architecture</a> ·
      <a href="../api/index.html">APIs</a> ·
      <a href="../syntax/index.html">Syntax</a> ·
      <a href="../usage-cli/index.html">CLI</a> ·
      <a href="../wiki/index.html">Wiki</a> ·
      <a href="../specs/matrix.html">Specs</a>
    </small>
    <div class="sub-nav">
      <strong>Architecture:</strong>
      <a href="index.html">Overview</a> ·
      <a href="geometry.html">Geometry</a> ·
      <a href="knowledge.html">Knowledge</a> ·
      <a href="learning.html">Learning</a> ·
      <a href="reasoning.html">Reasoning</a> ·
      <a href="inference.html">Inference</a> ·
      <a href="language.html">Language</a> ·
      <a href="storage.html">Storage</a> ·
      <a href="configuration.html">Configuration</a> ·
      <a href="evalsuite.html">Eval Suite</a>
    </div>
  </div>

  <p>This page explains how AGISystem2 learns: how new facts are ingested, how new concepts are created or expanded, and how new relations/verbs are registered so they become first-class citizens in both symbolic and geometric reasoning. The focus is on developer-facing steps rather than conceptual-space theory.</p>

  <div class="section-intro">
    <p><strong>Specification:</strong> DS(/ingest/parser.js) · DS(/ingest/encoder.js) · DS(/ingest/clustering.js) · DS(/core/relation_permuter.js) · DS(/core/dimension_registry.js) · DS(/knowledge/concept_store.js)</p>
  </div>

  <h2 id="facts">Learning New Facts</h2>
  <p>Facts are ingested through the EngineAPI or the Sys2DSL interpreter and are turned into both symbolic triples and geometric updates.</p>
  <ol>
    <li><strong>Normalisation:</strong> `TranslatorBridge.normalise` standardises casing and spacing before parsing.</li>
    <li><strong>Parsing:</strong> `NLParser.parseAssertion` or `parseQuestion` builds `{subject, relation, object}` AST nodes (`src/ingest/parser.js`).</li>
    <li><strong>Symbolic storage:</strong> `ConceptStore.addFact` persists the triple, indexes it by subject, tracks relation usage, and logs to `AuditLog`.</li>
    <li><strong>Geometric encoding:</strong> `Encoder.encodeNode` hashes subject/object into vectors, binds the object via relation permutation, activates relation/property dimensions (`DimensionRegistry`), and returns the vector.</li>
    <li><strong>Shape update:</strong> `ClusterManager.updateClusters` widens or splits the target concept’s bounded diamonds so the new observation is included.</li>
    <li><strong>Usage/priority:</strong> all touched concepts/relations receive usage boosts that later influence retrieval ranking and abductive scores.</li>
  </ol>

  <div class="diagram">
    <svg viewBox="0 0 560 120" role="img" aria-label="Fact learning flow">
      <defs>
        <marker id="arrow-learn" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto" markerUnits="strokeWidth">
          <path d="M0,0 L6,3 L0,6 z" fill="#0f4c81" />
        </marker>
      </defs>
      <rect x="20" y="30" width="80" height="50" rx="6" fill="#f5f7fb" stroke="#0f4c81" stroke-width="2"/>
      <text x="60" y="55" font-size="9" font-weight="bold" fill="#0f4c81" text-anchor="middle">Sys2DSL</text>
      <text x="60" y="68" font-size="7" fill="#4a5670" text-anchor="middle">Input</text>

      <rect x="120" y="30" width="90" height="50" rx="6" fill="#e1ecf7" stroke="#0f4c81" stroke-width="2"/>
      <text x="165" y="55" font-size="9" font-weight="bold" fill="#0f4c81" text-anchor="middle">Parser</text>
      <text x="165" y="68" font-size="7" fill="#4a5670" text-anchor="middle">AST</text>

      <rect x="230" y="30" width="90" height="50" rx="6" fill="#e1ecf7" stroke="#0f4c81" stroke-width="2"/>
      <text x="275" y="55" font-size="9" font-weight="bold" fill="#0f4c81" text-anchor="middle">Encoder</text>
      <text x="275" y="68" font-size="7" fill="#4a5670" text-anchor="middle">Permutation</text>

      <rect x="340" y="30" width="90" height="50" rx="6" fill="#e8f5e9" stroke="#2e7d32" stroke-width="2"/>
      <text x="385" y="55" font-size="9" font-weight="bold" fill="#2e7d32" text-anchor="middle">ConceptStore</text>
      <text x="385" y="68" font-size="7" fill="#4a5670" text-anchor="middle">Facts + Usage</text>

      <rect x="450" y="30" width="90" height="50" rx="6" fill="#fff3e0" stroke="#e65100" stroke-width="2"/>
      <text x="495" y="55" font-size="9" font-weight="bold" fill="#e65100" text-anchor="middle">ClusterManager</text>
      <text x="495" y="68" font-size="7" fill="#4a5670" text-anchor="middle">Diamond Update</text>

      <line x1="100" y1="55" x2="118" y2="55" stroke="#0f4c81" stroke-width="1.5" marker-end="url(#arrow-learn)"/>
      <line x1="210" y1="55" x2="228" y2="55" stroke="#0f4c81" stroke-width="1.5" marker-end="url(#arrow-learn)"/>
      <line x1="320" y1="55" x2="338" y2="55" stroke="#0f4c81" stroke-width="1.5" marker-end="url(#arrow-learn)"/>
      <line x1="430" y1="55" x2="448" y2="55" stroke="#0f4c81" stroke-width="1.5" marker-end="url(#arrow-learn)"/>
    </svg>
    <p class="diagram-caption">Fact ingestion: normalise → parse → encode → store triple → widen/split diamonds.</p>
  </div>

  <h2 id="concepts">Learning New Concepts</h2>
  <p>Concepts are created lazily and refined over time.</p>
  <ul>
    <li>`ConceptStore.ensureConcept` initialises a concept with a zero-radius `BoundedDiamond` and usage metrics.</li>
    <li>When the first observation arrives, `ClusterManager.updateClusters` re-initialises the empty diamond from the observation instead of widening from zeros.</li>
    <li>Subsequent observations widen the min/max bounds; if a vector is too far (`distanceMaskedL1` exceeds `l1Radius * splitFactor`), a new diamond/cluster is created.</li>
    <li>Usage tracking (`usageCount`, `priority`) promotes frequently used concepts for retrieval/abduction.</li>
    <li>Protection and forgetting rules live in `ConceptStore.protect/forget`, so learned concepts can be pruned without losing pinned ones.</li>
  </ul>

  <h2 id="relations">Learning New Relations / Verbs</h2>
  <p>Relations have both semantic metadata and geometric bindings.</p>
  <ul>
    <li><strong>Permutation binding:</strong> `RelationPermuter.register` builds deterministic permutations seeded by config. Unregistered relations are auto-registered during encoding.</li>
    <li><strong>Semantic axes:</strong> `DimensionRegistry` maps relation names to axis lists (`getRelationAxes`) so relation-specific dimensions can be activated during encoding.</li>
    <li><strong>Logical properties:</strong> the same registry holds `transitive`, `symmetric`, and `inverse` flags, feeding `InferenceEngine` and `Reasoner` for transitive/symmetric/inverse checks.</li>
    <li><strong>Persistence/authoring:</strong> new relations should be added to `data/init/relations.json` so bootstrapping and specs stay in sync; otherwise runtime auto-registration will work geometrically but without persisted metadata.</li>
  </ul>

  <h2>Operational Checklist</h2>
  <ul>
    <li>When adding a new fact source, ensure it passes through `TranslatorBridge` to keep normalisation deterministic.</li>
    <li>For new domains, extend `DimensionRegistry` data (`data/init/dimensions.json`) so properties map to the right axes before encoding.</li>
    <li>Add relations to `relations.json` with inverse/symmetric flags to unlock richer inference; rely on auto-registration only as a stopgap.</li>
    <li>Guard critical concepts with `ConceptStore.protect` if running forgetting/cleanup jobs.</li>
  </ul>

  <div class="footer-nav">
    <a href="knowledge.html">← Knowledge</a> ·
    <a href="inference.html">Inference →</a>
  </div>
  </div>
  <script src="../reference/nav2.js"></script>
</body>
</html>
