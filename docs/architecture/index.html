<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Architecture - AGISystem2</title>
  <link rel="stylesheet" href="../reference/style.css">
</head>
<body>
  <div class="page">
  <div class="nav-header">
    <h1>System Architecture</h1>
    <small>
      <a href="../index.html">Home</a> &middot;
      <a href="index.html">Architecture</a> &middot;
      <a href="../theory/index.html">Theory</a> &middot;
      <a href="../syntax/index.html">Syntax</a> &middot;
      <a href="../api/index.html">APIs</a> &middot;
      <a href="../wiki/index.html">Wiki</a> &middot;
      <a href="../specs/matrix.html">Specs</a>
    </small>
    <small>Layered design for neuro-symbolic reasoning</small>
  </div>

  <div class="section-intro">
    <p>AGISystem2 follows a layered architecture separating core HDC operations, runtime management, and high-level reasoning. This design enables modularity, testability, and clear responsibility boundaries.</p>
  </div>

  <h2>System Overview Diagram</h2>

  <div class="diagram-container">
    <div class="diagram-title">AGISystem2 Architecture Layers</div>
    <svg viewBox="0 0 800 500" xmlns="http://www.w3.org/2000/svg">
      <!-- Background layers -->
      <defs>
        <linearGradient id="layer1" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" style="stop-color:#e3f2fd"/>
          <stop offset="100%" style="stop-color:#bbdefb"/>
        </linearGradient>
        <linearGradient id="layer2" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" style="stop-color:#e8f5e9"/>
          <stop offset="100%" style="stop-color:#c8e6c9"/>
        </linearGradient>
        <linearGradient id="layer3" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" style="stop-color:#fff3e0"/>
          <stop offset="100%" style="stop-color:#ffe0b2"/>
        </linearGradient>
        <linearGradient id="layer4" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" style="stop-color:#fce4ec"/>
          <stop offset="100%" style="stop-color:#f8bbd9"/>
        </linearGradient>
      </defs>

      <!-- Layer 4: API Layer -->
      <rect x="50" y="20" width="700" height="80" rx="10" fill="url(#layer1)" stroke="#1976d2" stroke-width="2"/>
      <text x="400" y="45" text-anchor="middle" font-weight="bold" font-size="14" fill="#1976d2">API Layer</text>
      <text x="150" y="70" text-anchor="middle" font-size="12" fill="#333">learn()</text>
      <text x="280" y="70" text-anchor="middle" font-size="12" fill="#333">query()</text>
      <text x="400" y="70" text-anchor="middle" font-size="12" fill="#333">prove()</text>
      <text x="520" y="70" text-anchor="middle" font-size="12" fill="#333">summarize()</text>
      <text x="650" y="70" text-anchor="middle" font-size="12" fill="#333">elaborate()</text>

      <!-- Layer 3: Processing Layer -->
      <rect x="50" y="120" width="700" height="100" rx="10" fill="url(#layer2)" stroke="#4caf50" stroke-width="2"/>
      <text x="400" y="145" text-anchor="middle" font-weight="bold" font-size="14" fill="#4caf50">Processing Layer</text>

      <!-- Processing boxes -->
      <rect x="70" y="160" width="120" height="45" rx="5" fill="white" stroke="#4caf50"/>
      <text x="130" y="187" text-anchor="middle" font-size="11" fill="#333">Parser</text>

      <rect x="210" y="160" width="120" height="45" rx="5" fill="white" stroke="#4caf50"/>
      <text x="270" y="187" text-anchor="middle" font-size="11" fill="#333">Executor</text>

      <rect x="350" y="160" width="120" height="45" rx="5" fill="white" stroke="#4caf50"/>
      <text x="410" y="187" text-anchor="middle" font-size="11" fill="#333">Query Engine</text>

      <rect x="490" y="160" width="120" height="45" rx="5" fill="white" stroke="#4caf50"/>
      <text x="550" y="187" text-anchor="middle" font-size="11" fill="#333">Proof Engine</text>

      <rect x="630" y="160" width="100" height="45" rx="5" fill="white" stroke="#4caf50"/>
      <text x="680" y="187" text-anchor="middle" font-size="11" fill="#333">Decoder</text>

      <!-- Layer 2: Runtime Layer -->
      <rect x="50" y="240" width="700" height="100" rx="10" fill="url(#layer3)" stroke="#ff9800" stroke-width="2"/>
      <text x="400" y="265" text-anchor="middle" font-weight="bold" font-size="14" fill="#e65100">Runtime Layer</text>

      <!-- Runtime boxes -->
      <rect x="80" y="280" width="100" height="45" rx="5" fill="white" stroke="#ff9800"/>
      <text x="130" y="307" text-anchor="middle" font-size="11" fill="#333">Session</text>

      <rect x="200" y="280" width="100" height="45" rx="5" fill="white" stroke="#ff9800"/>
      <text x="250" y="307" text-anchor="middle" font-size="11" fill="#333">Scope</text>

      <rect x="320" y="280" width="130" height="45" rx="5" fill="white" stroke="#ff9800"/>
      <text x="385" y="307" text-anchor="middle" font-size="11" fill="#333">Theory Registry</text>

      <rect x="470" y="280" width="130" height="45" rx="5" fill="white" stroke="#ff9800"/>
      <text x="535" y="307" text-anchor="middle" font-size="11" fill="#333">Knowledge Base</text>

      <rect x="620" y="280" width="110" height="45" rx="5" fill="white" stroke="#ff9800"/>
      <text x="675" y="307" text-anchor="middle" font-size="11" fill="#333">Vocabulary</text>

      <!-- Layer 1: Core HDC Layer -->
      <rect x="50" y="360" width="700" height="100" rx="10" fill="url(#layer4)" stroke="#e91e63" stroke-width="2"/>
      <text x="400" y="385" text-anchor="middle" font-weight="bold" font-size="14" fill="#c2185b">Core HDC Layer</text>

      <!-- Core boxes -->
      <rect x="100" y="400" width="100" height="45" rx="5" fill="white" stroke="#e91e63"/>
      <text x="150" y="427" text-anchor="middle" font-size="11" fill="#333">Vector</text>

      <rect x="230" y="400" width="100" height="45" rx="5" fill="white" stroke="#e91e63"/>
      <text x="280" y="427" text-anchor="middle" font-size="11" fill="#333">Operations</text>

      <rect x="360" y="400" width="100" height="45" rx="5" fill="white" stroke="#e91e63"/>
      <text x="410" y="427" text-anchor="middle" font-size="11" fill="#333">Position</text>

      <rect x="490" y="400" width="100" height="45" rx="5" fill="white" stroke="#e91e63"/>
      <text x="540" y="427" text-anchor="middle" font-size="11" fill="#333">ASCII Stamp</text>

      <rect x="620" y="400" width="100" height="45" rx="5" fill="white" stroke="#e91e63"/>
      <text x="670" y="427" text-anchor="middle" font-size="11" fill="#333">Constants</text>

      <!-- Arrows -->
      <path d="M400 100 L400 120" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
      <path d="M400 220 L400 240" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
      <path d="M400 340 L400 360" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>

      <defs>
        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
          <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
        </marker>
      </defs>
    </svg>
  </div>

  <h2>Layer Descriptions</h2>

  <div class="section-grid">
    <div class="section-card">
      <h3>API Layer</h3>
      <p>Public interface for developers. Provides high-level methods for learning facts, querying knowledge, proving goals, and generating explanations. Designed for ease of use and integration.</p>
      <ul>
        <li><code>learn(dsl)</code> - Add facts and definitions</li>
        <li><code>query(dsl)</code> - Find answers with holes</li>
        <li><code>prove(goal)</code> - Build proof trees</li>
        <li><code>summarize()</code> - Concise output</li>
        <li><code>elaborate()</code> - Detailed narratives</li>
      </ul>
    </div>

    <div class="section-card">
      <h3>Processing Layer</h3>
      <p>Core logic for transforming DSL input into vector operations and back. Handles parsing, execution, query resolution, proof search, and result decoding.</p>
      <ul>
        <li><strong>Parser:</strong> DSL text to AST</li>
        <li><strong>Executor:</strong> AST to vector operations</li>
        <li><strong>Query Engine:</strong> Hole-filling search</li>
        <li><strong>Proof Engine:</strong> Backward chaining</li>
        <li><strong>Decoder:</strong> Vector to structure</li>
      </ul>
    </div>

    <div class="section-card">
      <h3>Runtime Layer</h3>
      <p>State management for sessions, variables, theories, and knowledge. Maintains isolation between sessions and manages the lifecycle of reasoning contexts.</p>
      <ul>
        <li><strong>Session:</strong> Isolated reasoning context</li>
        <li><strong>Scope:</strong> Variable hierarchy</li>
        <li><strong>Theory Registry:</strong> Loaded theories</li>
        <li><strong>Knowledge Base:</strong> Bundled facts</li>
        <li><strong>Vocabulary:</strong> Known atoms</li>
      </ul>
    </div>

    <div class="section-card">
      <h3>Core HDC Layer</h3>
      <p>Fundamental hyperdimensional computing operations. Provides vector storage, binding (XOR), bundling (majority), similarity, and deterministic initialization.</p>
      <ul>
        <li><strong>Vector:</strong> 32K-bit storage</li>
        <li><strong>Operations:</strong> Bind, Bundle, Similarity</li>
        <li><strong>Position:</strong> Pos1-Pos20 vectors</li>
        <li><strong>ASCII Stamp:</strong> Deterministic init</li>
        <li><strong>Constants:</strong> Geometry, thresholds</li>
      </ul>
    </div>
  </div>

  <h2>Data Flow</h2>

  <div class="diagram-container">
    <div class="diagram-title">Query Execution Pipeline</div>
    <svg viewBox="0 0 800 200" xmlns="http://www.w3.org/2000/svg">
      <!-- Boxes -->
      <rect x="20" y="60" width="120" height="60" rx="8" fill="#e3f2fd" stroke="#1976d2" stroke-width="2"/>
      <text x="80" y="85" text-anchor="middle" font-size="11" fill="#333">DSL Text</text>
      <text x="80" y="100" text-anchor="middle" font-size="10" fill="#666">@q loves ?who Mary</text>

      <rect x="170" y="60" width="100" height="60" rx="8" fill="#e8f5e9" stroke="#4caf50" stroke-width="2"/>
      <text x="220" y="85" text-anchor="middle" font-size="11" fill="#333">Parse</text>
      <text x="220" y="100" text-anchor="middle" font-size="10" fill="#666">AST nodes</text>

      <rect x="300" y="60" width="100" height="60" rx="8" fill="#fff3e0" stroke="#ff9800" stroke-width="2"/>
      <text x="350" y="85" text-anchor="middle" font-size="11" fill="#333">Build Partial</text>
      <text x="350" y="100" text-anchor="middle" font-size="10" fill="#666">Skip holes</text>

      <rect x="430" y="60" width="100" height="60" rx="8" fill="#fce4ec" stroke="#e91e63" stroke-width="2"/>
      <text x="480" y="85" text-anchor="middle" font-size="11" fill="#333">Unbind KB</text>
      <text x="480" y="100" text-anchor="middle" font-size="10" fill="#666">XOR search</text>

      <rect x="560" y="60" width="100" height="60" rx="8" fill="#f3e5f5" stroke="#9c27b0" stroke-width="2"/>
      <text x="610" y="85" text-anchor="middle" font-size="11" fill="#333">Match</text>
      <text x="610" y="100" text-anchor="middle" font-size="10" fill="#666">Top-K similar</text>

      <rect x="690" y="60" width="90" height="60" rx="8" fill="#e0f7fa" stroke="#00bcd4" stroke-width="2"/>
      <text x="735" y="85" text-anchor="middle" font-size="11" fill="#333">Result</text>
      <text x="735" y="100" text-anchor="middle" font-size="10" fill="#666">?who = John</text>

      <!-- Arrows -->
      <path d="M140 90 L165 90" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
      <path d="M270 90 L295 90" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
      <path d="M400 90 L425 90" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
      <path d="M530 90 L555 90" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
      <path d="M660 90 L685 90" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
    </svg>
  </div>

  <h2>Module Directory Structure</h2>

  <pre><code>src/
├── core/                    # Core HDC Layer
│   ├── vector.js            # Vector storage & manipulation
│   ├── operations.js        # Bind, Bundle, Similarity
│   ├── position.js          # Position vectors
│   └── constants.js         # Configuration
│
├── util/                    # Utilities
│   ├── ascii-stamp.js       # Deterministic initialization
│   ├── prng.js              # Seeded randomness
│   └── hash.js              # String to seed
│
├── parser/                  # DSL Processing
│   ├── lexer.js             # Tokenization
│   ├── parser.js            # AST construction
│   └── ast.js               # Node definitions
│
├── runtime/                 # Runtime Layer
│   ├── session.js           # Main API surface
│   ├── executor.js          # Statement execution
│   ├── scope.js             # Variable management
│   └── theory/              # Theory management
│       ├── registry.js      # Theory storage
│       ├── loader.js        # File loading
│       └── core-theory.js   # Built-in Core
│
├── reasoning/               # Reasoning Systems
│   ├── query.js             # Single-step queries
│   ├── prove.js             # Multi-step proofs
│   ├── rules.js             # Rule matching
│   └── unify.js             # Unification
│
├── decoding/                # Output Generation
│   ├── structural-decoder.js# Vector to structure
│   ├── phrasing-registry.js # Template storage
│   ├── text-generator.js    # Slot filling
│   └── elaborator.js        # LLM integration
│
└── bridge/                  # Integration
    └── evaluator.js         # JS-HDC bridge</code></pre>

  <h2>Design Principles</h2>

  <table>
    <tr>
      <th>Principle</th>
      <th>Description</th>
      <th>Benefit</th>
    </tr>
    <tr>
      <td><strong>Layered Separation</strong></td>
      <td>Each layer has clear responsibilities and interfaces</td>
      <td>Testability, maintainability</td>
    </tr>
    <tr>
      <td><strong>Determinism First</strong></td>
      <td>All operations produce identical results for identical inputs</td>
      <td>Reproducibility, debugging</td>
    </tr>
    <tr>
      <td><strong>Minimal Operations</strong></td>
      <td>Only Bind (XOR) and Bundle (Majority) at core</td>
      <td>Mathematical elegance, provability</td>
    </tr>
    <tr>
      <td><strong>Session Isolation</strong></td>
      <td>Sessions are independent reasoning contexts</td>
      <td>Multi-tenancy, parallelism</td>
    </tr>
    <tr>
      <td><strong>Theory Composability</strong></td>
      <td>Theories can be loaded and stacked</td>
      <td>Reusability, domain separation</td>
    </tr>
    <tr>
      <td><strong>Confidence Transparency</strong></td>
      <td>All results include confidence scores</td>
      <td>Trust calibration</td>
    </tr>
  </table>

  <h2>Related Documentation</h2>

  <ul>
    <li><a href="../theory/index.html">Theoretical Foundation</a> - Why this architecture works</li>
    <li><a href="../api/index.html">API Reference</a> - Detailed method documentation</li>
    <li><a href="../specs/DS/DS03-Architecture.md">DS03 - Architecture Specification</a> - Full technical details</li>
  </ul>

  <div class="footer-nav">
    <p>AGISystem2 architecture is designed for deterministic, explainable reasoning with clear separation of concerns.</p>
  </div>
  </div>
</body>
</html>
