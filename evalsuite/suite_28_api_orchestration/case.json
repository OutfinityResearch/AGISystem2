{
  "id": "suite_28_api_orchestration",
  "name": "API Call Sequencing - E-Commerce Order Flow",
  "description": "Tests planning the exact sequence of API calls with parameters, authentication tokens, and data passing for processing an e-commerce order from cart to delivery.",

  "theory": {
    "natural_language": "ORDER PROCESSING FLOW: Call 1 invokes auth_api with credentials parameter outputting auth_token to variable token. Call 2 invokes cart_api with token and user_id parameters outputting cart_contents to variable items. Call 3 invokes inventory_api with token and items parameters outputting availability_status to variable stock. Call 4 invokes pricing_api with items and promo_code parameters outputting final_price to variable total. Call 5 invokes payment_api with token and total and payment_method parameters outputting transaction_id to variable txn. Call 6 invokes order_api with token and items and txn parameters outputting order_id to variable order. Call 7 invokes shipping_api with order and address parameters outputting tracking_number to variable tracking. Call 8 invokes notification_api with order and tracking and email parameters outputting confirmation_sent to variable done. DATA DEPENDENCIES: cart_api requires auth_token from call_1. inventory_api requires auth_token and cart_contents. pricing_api requires cart_contents. payment_api requires auth_token and final_price. order_api requires auth_token and cart_contents and transaction_id. shipping_api requires order_id. notification_api requires order_id and tracking_number. ERROR SCENARIOS: If stock shows out_of_stock then abort with inventory_error. If txn shows declined then abort with payment_error. If address shows invalid then abort with shipping_error.",
    "expected_facts": [
      "call_1 INVOKES auth_api",
      "call_1 WITH_PARAM credentials",
      "call_1 OUTPUTS auth_token",
      "call_1 TO_VAR token",
      "call_2 INVOKES cart_api",
      "call_2 USES_VAR token",
      "call_2 WITH_PARAM user_id",
      "call_2 OUTPUTS cart_contents",
      "call_2 TO_VAR items",
      "call_3 INVOKES inventory_api",
      "call_3 USES_VAR token",
      "call_3 USES_VAR items",
      "call_3 OUTPUTS availability_status",
      "call_3 TO_VAR stock",
      "call_4 INVOKES pricing_api",
      "call_4 USES_VAR items",
      "call_4 WITH_PARAM promo_code",
      "call_4 OUTPUTS final_price",
      "call_4 TO_VAR total",
      "call_5 INVOKES payment_api",
      "call_5 USES_VAR token",
      "call_5 USES_VAR total",
      "call_5 WITH_PARAM payment_method",
      "call_5 OUTPUTS transaction_id",
      "call_5 TO_VAR txn",
      "call_6 INVOKES order_api",
      "call_6 USES_VAR token",
      "call_6 USES_VAR items",
      "call_6 USES_VAR txn",
      "call_6 OUTPUTS order_id",
      "call_6 TO_VAR order",
      "call_7 INVOKES shipping_api",
      "call_7 USES_VAR order",
      "call_7 WITH_PARAM address",
      "call_7 OUTPUTS tracking_number",
      "call_7 TO_VAR tracking",
      "call_8 INVOKES notification_api",
      "call_8 USES_VAR order",
      "call_8 USES_VAR tracking",
      "call_8 WITH_PARAM email",
      "call_8 OUTPUTS confirmation_sent",
      "out_of_stock ABORTS_WITH inventory_error",
      "declined ABORTS_WITH payment_error",
      "invalid_address ABORTS_WITH shipping_error"
    ]
  },

  "queries": [
    {
      "id": "q1",
      "natural_language": "INIT: What is the first API call and what variable does it produce?",
      "expected_dsl": "@q1 FACTS_MATCHING call_1 INVOKES ?",
      "expected_answer": {
        "natural_language": "Call 1 invokes auth_api and outputs auth_token to variable token.",
        "truth": "LIST",
        "explanation": "Authentication as first step"
      }
    },
    {
      "id": "q2",
      "natural_language": "TOKEN USAGE: Which calls need the authentication token?",
      "expected_dsl": "@q2 FACTS_MATCHING ? USES_VAR token",
      "expected_answer": {
        "natural_language": "call_2, call_3, call_5, and call_6 all use the token variable.",
        "truth": "LIST",
        "explanation": "Auth token propagation"
      }
    },
    {
      "id": "q3",
      "natural_language": "CALL 5 SETUP: What variables and parameters does the payment call need?",
      "expected_dsl": "@q3 FACTS_MATCHING call_5 USES_VAR ?",
      "expected_answer": {
        "natural_language": "Call 5 uses token and total variables.",
        "truth": "LIST",
        "explanation": "Payment API input requirements"
      }
    },
    {
      "id": "q4",
      "natural_language": "ORDER CREATION: What does call_6 need from previous calls?",
      "expected_dsl": "@q4 FACTS_MATCHING call_6 USES_VAR ?",
      "expected_answer": {
        "natural_language": "Call 6 uses token, items, and txn from previous calls.",
        "truth": "LIST",
        "explanation": "Order API aggregates multiple outputs"
      }
    },
    {
      "id": "q5",
      "natural_language": "USER INPUT: Which calls require external parameters (not from previous calls)?",
      "expected_dsl": "@q5 FACTS_MATCHING ? WITH_PARAM ?",
      "expected_answer": {
        "natural_language": "Calls need: credentials, user_id, promo_code, payment_method, address, email.",
        "truth": "LIST",
        "explanation": "External configuration parameters"
      }
    },
    {
      "id": "q6",
      "natural_language": "ERROR: What happens if payment is declined?",
      "expected_dsl": "@q6 FACTS_MATCHING declined ABORTS_WITH ?",
      "expected_answer": {
        "natural_language": "Declined payment aborts with payment_error.",
        "truth": "LIST",
        "explanation": "Payment failure handling"
      }
    },
    {
      "id": "q7",
      "natural_language": "SHIPPING SETUP: What does call_7 output and to which variable?",
      "expected_dsl": "@q7 FACTS_MATCHING call_7 OUTPUTS ?",
      "expected_answer": {
        "natural_language": "Call 7 outputs tracking_number to variable tracking.",
        "truth": "LIST",
        "explanation": "Shipping API output"
      }
    },
    {
      "id": "q8",
      "natural_language": "FINAL CALL: What does the notification call need to send confirmation?",
      "expected_dsl": "@q8 FACTS_MATCHING call_8 USES_VAR ?",
      "expected_answer": {
        "natural_language": "Call 8 uses order and tracking variables.",
        "truth": "LIST",
        "explanation": "Final notification dependencies"
      }
    }
  ],

  "tags": ["api_orchestration", "ecommerce", "call_sequence", "variable_passing", "error_handling", "authentication"]
}
