{
  "id": "suite_28_api_orchestration",
  "name": "API Call Sequencing - E-Commerce Order Flow",
  "description": "Tests API call sequence planning with DSL-validatable proof chains for e-commerce order processing.",
  "theory": {
    "natural_language": "ORDER PROCESSING: Call 1 invokes auth_api outputting auth_token. Call 2 invokes cart_api using token outputting cart_contents. Call 3 invokes inventory_api using token and items outputting availability_status. Call 4 invokes pricing_api using items outputting final_price. Call 5 invokes payment_api using token and total outputting transaction_id. Call 6 invokes order_api using token items txn outputting order_id. Call 7 invokes shipping_api using order outputting tracking_number. Call 8 invokes notification_api using order and tracking. ERROR SCENARIOS: declined aborts with payment_error. invalid_address aborts with shipping_error.",
    "expected_facts": [
      "call_1 INVOKES auth_api",
      "call_1 OUTPUTS auth_token",
      "call_1 TO_VAR token",
      "call_2 INVOKES cart_api",
      "call_2 USES_VAR token",
      "call_2 OUTPUTS cart_contents",
      "call_3 INVOKES inventory_api",
      "call_3 USES_VAR token",
      "call_3 USES_VAR items",
      "call_4 INVOKES pricing_api",
      "call_4 USES_VAR items",
      "call_4 OUTPUTS final_price",
      "call_5 INVOKES payment_api",
      "call_5 USES_VAR token",
      "call_5 USES_VAR total",
      "call_5 OUTPUTS transaction_id",
      "call_6 INVOKES order_api",
      "call_6 USES_VAR token",
      "call_6 USES_VAR items",
      "call_6 USES_VAR txn",
      "call_6 OUTPUTS order_id",
      "call_7 INVOKES shipping_api",
      "call_7 USES_VAR order",
      "call_7 OUTPUTS tracking_number",
      "call_8 INVOKES notification_api",
      "call_8 USES_VAR order",
      "call_8 USES_VAR tracking",
      "declined ABORTS_WITH payment_error",
      "invalid_address ABORTS_WITH shipping_error"
    ]
  },
  "queries": [
    {
      "id": "q1",
      "natural_language": "INIT: What is the first API call?",
      "expected_dsl": "@inv ASK call_1 INVOKES auth_api\n@out ASK call_1 OUTPUTS auth_token\n@q1 BOOL_AND $inv $out",
      "expected_answer": {
        "dsl_explanation": "@i1 ASK call_1 INVOKES auth_api\n@o1 ASK call_1 OUTPUTS auth_token\n@first BOOL_AND $i1 $o1\n# Result: @first.truth = TRUE_CERTAIN proves call_1 invokes auth_api outputting auth_token"
      }
    },
    {
      "id": "q2",
      "natural_language": "TOKEN: Which calls use the token?",
      "expected_dsl": "@u1 ASK call_2 USES_VAR token\n@u2 ASK call_3 USES_VAR token\n@u3 ASK call_5 USES_VAR token\n@u4 ASK call_6 USES_VAR token\n@p1 BOOL_AND $u1 $u2\n@p2 BOOL_AND $u3 $u4\n@q2 BOOL_AND $p1 $p2",
      "expected_answer": {
        "dsl_explanation": "@t1 ASK call_2 USES_VAR token\n@t2 ASK call_3 USES_VAR token\n@t3 ASK call_5 USES_VAR token\n@t4 ASK call_6 USES_VAR token\n@g1 BOOL_AND $t1 $t2\n@g2 BOOL_AND $t3 $t4\n@all_token BOOL_AND $g1 $g2\n# Result: @all_token.truth = TRUE_CERTAIN proves call_2, call_3, call_5, call_6 use token"
      }
    },
    {
      "id": "q3",
      "natural_language": "PAYMENT: What does call_5 need?",
      "expected_dsl": "@v1 ASK call_5 USES_VAR token\n@v2 ASK call_5 USES_VAR total\n@q3 BOOL_AND $v1 $v2",
      "expected_answer": {
        "dsl_explanation": "@p1 ASK call_5 USES_VAR token\n@p2 ASK call_5 USES_VAR total\n@pay BOOL_AND $p1 $p2\n# Result: @pay.truth = TRUE_CERTAIN proves call_5 uses token AND total"
      }
    },
    {
      "id": "q4",
      "natural_language": "ORDER: What variables does call_6 use?",
      "expected_dsl": "@v1 ASK call_6 USES_VAR token\n@v2 ASK call_6 USES_VAR items\n@v3 ASK call_6 USES_VAR txn\n@p1 BOOL_AND $v1 $v2\n@q4 BOOL_AND $p1 $v3",
      "expected_answer": {
        "dsl_explanation": "@o1 ASK call_6 USES_VAR token\n@o2 ASK call_6 USES_VAR items\n@o3 ASK call_6 USES_VAR txn\n@g1 BOOL_AND $o1 $o2\n@order BOOL_AND $g1 $o3\n# Result: @order.truth = TRUE_CERTAIN proves call_6 uses token, items, txn"
      }
    },
    {
      "id": "q5",
      "natural_language": "OUTPUTS: What does call_4 output?",
      "expected_dsl": "@inv ASK call_4 INVOKES pricing_api\n@out ASK call_4 OUTPUTS final_price\n@q5 BOOL_AND $inv $out",
      "expected_answer": {
        "dsl_explanation": "@i4 ASK call_4 INVOKES pricing_api\n@o4 ASK call_4 OUTPUTS final_price\n@price BOOL_AND $i4 $o4\n# Result: @price.truth = TRUE_CERTAIN proves call_4 invokes pricing_api outputting final_price"
      }
    },
    {
      "id": "q6",
      "natural_language": "ERROR: What happens on declined payment?",
      "expected_dsl": "@q6 ASK declined ABORTS_WITH payment_error",
      "expected_answer": {
        "dsl_explanation": "@err ASK declined ABORTS_WITH payment_error\n# Result: @err.truth = TRUE_CERTAIN proves declined aborts with payment_error"
      }
    },
    {
      "id": "q7",
      "natural_language": "SHIPPING: What does call_7 output?",
      "expected_dsl": "@inv ASK call_7 INVOKES shipping_api\n@out ASK call_7 OUTPUTS tracking_number\n@q7 BOOL_AND $inv $out",
      "expected_answer": {
        "dsl_explanation": "@s1 ASK call_7 INVOKES shipping_api\n@s2 ASK call_7 OUTPUTS tracking_number\n@ship BOOL_AND $s1 $s2\n# Result: @ship.truth = TRUE_CERTAIN proves call_7 invokes shipping_api outputting tracking_number"
      }
    },
    {
      "id": "q8",
      "natural_language": "NOTIFICATION: What does call_8 use?",
      "expected_dsl": "@v1 ASK call_8 USES_VAR order\n@v2 ASK call_8 USES_VAR tracking\n@q8 BOOL_AND $v1 $v2",
      "expected_answer": {
        "dsl_explanation": "@n1 ASK call_8 USES_VAR order\n@n2 ASK call_8 USES_VAR tracking\n@notify BOOL_AND $n1 $n2\n# Result: @notify.truth = TRUE_CERTAIN proves call_8 uses order AND tracking"
      }
    }
  ],
  "tags": [
    "api_orchestration",
    "ecommerce",
    "call_sequence",
    "multi_statement",
    "dsl_validatable"
  ]
}